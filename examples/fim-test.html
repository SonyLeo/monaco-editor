<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Code Assistant - FIM Test</title>
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1e1e1e;
      color: #d4d4d4;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-bottom: 1px solid #3e3e3e;
    }

    .header h1 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .header p {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      opacity: 0.9;
    }

    .container {
      display: flex;
      flex: 1;
      gap: 1rem;
      padding: 1rem;
    }

    .editor-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      border: 1px solid #3e3e3e;
      border-radius: 4px;
      overflow: hidden;
    }

    .editor-title {
      padding: 0.5rem 1rem;
      background: #252526;
      border-bottom: 1px solid #3e3e3e;
      font-size: 0.9rem;
      font-weight: 500;
    }

    #editor {
      flex: 1;
    }

    .console-section {
      width: 350px;
      display: flex;
      flex-direction: column;
      border: 1px solid #3e3e3e;
      border-radius: 4px;
      overflow: hidden;
    }

    .console-title {
      padding: 0.5rem 1rem;
      background: #252526;
      border-bottom: 1px solid #3e3e3e;
      font-size: 0.9rem;
      font-weight: 500;
    }

    #console {
      flex: 1;
      overflow-y: auto;
      padding: 0.75rem;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
    }

    .log-entry {
      margin-bottom: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 2px;
    }

    .log-entry.info {
      color: #4fc3f7;
    }

    .log-entry.success {
      color: #81c784;
    }

    .log-entry.error {
      color: #e57373;
    }

    .instructions {
      padding: 0.75rem;
      background: #252526;
      border-left: 3px solid #ffb74d;
      border-radius: 2px;
      font-size: 0.85rem;
      line-height: 1.5;
      margin-bottom: 0.5rem;
    }

    .instructions strong {
      color: #ffb74d;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>⚡ FIM (Fill-In-Middle) Test</h1>
    <p>Type code to see real-time Ghost Text completions. Press Tab to accept.</p>
  </div>

  <div class="container">
    <div class="editor-section">
      <div class="editor-title">Editor</div>
      <div id="editor"></div>
    </div>

    <div class="console-section">
      <div class="console-title">Console</div>
      <div id="console">
        <div class="instructions">
          <strong>Tips:</strong><br />
          • Type code to trigger FIM<br />
          • Gray text = Ghost Text<br />
          • Press Tab to accept<br />
          • Press Esc to dismiss
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
  <script>
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });

    const consoleDiv = document.getElementById('console');

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      consoleDiv.appendChild(entry);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    const originalLog = console.log;
    const originalError = console.error;

    console.log = function (...args) {
      originalLog(...args);
      addLog(args.join(' '), 'info');
    };

    console.error = function (...args) {
      originalError(...args);
      addLog(args.join(' '), 'error');
    };

    require(['vs/editor/editor.main'], async function () {
      console.log('✅ Monaco Editor loaded');

      const { initAICodeAssistant } = await import('../ai-code-assistant/index.ts');

      const editor = monaco.editor.create(document.getElementById('editor'), {
        value: `// FIM Test - Type code to see completions

function add(a, b) {
  return `,
        language: 'typescript',
        theme: 'vs-dark',
        fontSize: 14,
        automaticLayout: true,
        minimap: { enabled: false },
      });

      console.log('✅ Editor created');

      try {
        const assistant = initAICodeAssistant(monaco, editor, {
          fim: {
            enabled: true,
            endpoint: 'http://localhost:3000/api/completion',
          },
          nes: {
            enabled: false, // Disable NES for FIM testing
          },
        });

        console.log('✅ FIM Engine initialized');
        console.log('Start typing to see Ghost Text completions...');
      } catch (error) {
        console.error('Failed to initialize:', error);
      }
    });
  </script>
</body>
</html>
