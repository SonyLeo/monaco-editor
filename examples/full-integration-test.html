<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Code Assistant - Full Integration Test</title>
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1e1e1e;
      color: #d4d4d4;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-bottom: 1px solid #3e3e3e;
    }

    .header h1 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .header p {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      opacity: 0.9;
    }

    .container {
      display: flex;
      flex: 1;
      gap: 1rem;
      padding: 1rem;
    }

    .editor-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      border: 1px solid #3e3e3e;
      border-radius: 4px;
      overflow: hidden;
    }

    .editor-title {
      padding: 0.5rem 1rem;
      background: #252526;
      border-bottom: 1px solid #3e3e3e;
      font-size: 0.9rem;
      font-weight: 500;
    }

    #editor {
      flex: 1;
    }

    .panel {
      width: 350px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .panel-section {
      display: flex;
      flex-direction: column;
      border: 1px solid #3e3e3e;
      border-radius: 4px;
      overflow: hidden;
    }

    .panel-title {
      padding: 0.5rem 1rem;
      background: #252526;
      border-bottom: 1px solid #3e3e3e;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 0.75rem;
      font-size: 0.85rem;
      max-height: 300px;
    }

    .status-item {
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      background: #252526;
      border-left: 3px solid #667eea;
      border-radius: 2px;
    }

    .status-label {
      font-weight: 600;
      color: #4fc3f7;
      margin-bottom: 0.25rem;
    }

    .status-value {
      font-size: 0.8rem;
      color: #b0bec5;
    }

    .log-entry {
      margin-bottom: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 2px;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
    }

    .log-entry.info {
      color: #4fc3f7;
    }

    .log-entry.success {
      color: #81c784;
    }

    .log-entry.error {
      color: #e57373;
    }

    .log-entry.warning {
      color: #ffb74d;
    }

    .instructions {
      padding: 0.75rem;
      background: #252526;
      border-left: 3px solid #ffb74d;
      border-radius: 2px;
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .instructions strong {
      color: #ffb74d;
    }

    .instructions code {
      background: #1e1e1e;
      padding: 0.2rem 0.4rem;
      border-radius: 2px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸš€ AI Code Assistant - Full Integration Test</h1>
    <p>Test FIM (real-time completion) and NES (edit prediction) together</p>
  </div>

  <div class="container">
    <div class="editor-section">
      <div class="editor-title">Editor</div>
      <div id="editor"></div>
    </div>

    <div class="panel">
      <div class="panel-section">
        <div class="panel-title">Status</div>
        <div class="panel-content" id="status">
          <div class="instructions">
            <strong>Test Scenarios:</strong><br />
            1. Type code â†’ see FIM Ghost Text<br />
            2. Rename function â†’ see NES suggestions<br />
            3. Add parameter â†’ see NES suggestions<br />
            4. Fix typo â†’ see NES suggestions<br />
            <br />
            <strong>Shortcuts:</strong><br />
            <code>Tab</code> Accept suggestion<br />
            <code>Alt+N</code> Skip suggestion<br />
            <code>Esc</code> Close preview
          </div>
        </div>
      </div>

      <div class="panel-section">
        <div class="panel-title">Console</div>
        <div class="panel-content" id="console"></div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
  <script>
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });

    const statusDiv = document.getElementById('status');
    const consoleDiv = document.getElementById('console');

    function addStatus(label, value, type = 'info') {
      const item = document.createElement('div');
      item.className = 'status-item';
      item.innerHTML = `
        <div class="status-label">${label}</div>
        <div class="status-value">${value}</div>
      `;
      statusDiv.insertBefore(item, statusDiv.firstChild);
      while (statusDiv.children.length > 8) {
        statusDiv.removeChild(statusDiv.lastChild);
      }
    }

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      consoleDiv.appendChild(entry);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    console.log = function (...args) {
      originalLog(...args);
      addLog(args.join(' '), 'info');
    };

    console.error = function (...args) {
      originalError(...args);
      addLog(args.join(' '), 'error');
    };

    console.warn = function (...args) {
      originalWarn(...args);
      addLog(args.join(' '), 'warning');
    };

    require(['vs/editor/editor.main'], async function () {
      console.log('âœ… Monaco Editor loaded');

      const { initAICodeAssistant } = await import('../ai-code-assistant/index.ts');

      const editor = monaco.editor.create(document.getElementById('editor'), {
        value: `function hello() {
  console.log("Hello, World!");
  return true;
}

const result = hello();
console.log(result);
`,
        language: 'typescript',
        theme: 'vs-dark',
        fontSize: 14,
        automaticLayout: true,
        minimap: { enabled: false },
        glyphMargin: true,
      });

      console.log('âœ… Editor created');

      // åˆå§‹åŒ– AI åŠ©æ‰‹ï¼ˆFIM + NESï¼‰
      const assistant = initAICodeAssistant(monaco, editor, {
        fim: {
          enabled: true,
          endpoint: 'http://localhost:3000/api/completion',
          debounceMs: 300,
        },
        nes: {
          enabled: true,
          endpoint: 'http://localhost:3000/api/next-edit-prediction',
          debounceMs: 500,
        },
      });

      console.log('âœ… AI Code Assistant initialized (FIM + NES)');
      addStatus('FIM Status', 'Enabled âœ“', 'success');
      addStatus('NES Status', 'Enabled âœ“', 'success');

      // ç›‘å¬ç¼–è¾‘äº‹ä»¶
      let editCount = 0;
      editor.onDidChangeModelContent(() => {
        editCount++;
        addStatus('Edits', `${editCount} edits`, 'info');
      });

      console.log('âœ… Ready for testing!');
      addStatus('System', 'Ready for testing', 'success');
    });
  </script>
</body>
</html>
