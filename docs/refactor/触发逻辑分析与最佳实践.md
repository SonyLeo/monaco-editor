# FIM ä¸ NES è§¦å‘é€»è¾‘åˆ†æä¸æœ€ä½³å®è·µ

## ä¸€ã€å½“å‰é—®é¢˜åˆ†æ

### 1.1 è§¦å‘é€»è¾‘é‡å¤

**é—®é¢˜ï¼š** FIM å’Œ NES éƒ½ç›‘å¬ `onDidChangeModelContent`ï¼Œå¯¼è‡´åŒæ—¶è§¦å‘

```typescript
// FastCompletionProvider.ts
monaco.languages.registerInlineCompletionsProvider('typescript', {
  provideInlineCompletions: async (model, position, _, token) => {
    // æ¯æ¬¡å†…å®¹å˜åŒ–éƒ½ä¼šè§¦å‘
  }
});

// NESController.ts
this.editor.onDidChangeModelContent((e) => {
  // æ¯æ¬¡å†…å®¹å˜åŒ–ä¹Ÿä¼šè§¦å‘
  this.handleContentChange(e);
});
```

**åæœï¼š**
- ç”¨æˆ·æ‰“ä¸€ä¸ªå­—ç¬¦ï¼Œä¸¤ä¸ªå¼•æ“åŒæ—¶å·¥ä½œ
- èµ„æºæµªè´¹ï¼ŒAPI è°ƒç”¨é‡å¤
- ç”¨æˆ·ä½“éªŒæ··ä¹±ï¼ˆä¸çŸ¥é“å“ªä¸ªå»ºè®®ä¼šå‡ºç°ï¼‰

---

### 1.2 åº”ç”¨åœºæ™¯é‡å 

| åœºæ™¯ | FIM æ˜¯å¦è§¦å‘ | NES æ˜¯å¦è§¦å‘ | å†²çª |
|------|-------------|-------------|------|
| å‚æ•°è¡¥å…¨ | âœ… | âœ… | âŒ é‡å¤ |
| å‡½æ•°ä½“è¡¥å…¨ | âœ… | âœ… | âŒ é‡å¤ |
| å˜é‡åè¡¥å…¨ | âœ… | âŒ | âœ… æ­£å¸¸ |
| è·¨æ–‡ä»¶ä¿®æ”¹é¢„æµ‹ | âŒ | âœ… | âœ… æ­£å¸¸ |
| é‡æ„å»ºè®® | âŒ | âœ… | âœ… æ­£å¸¸ |

**ç»“è®ºï¼š** 60% çš„åœºæ™¯å­˜åœ¨é‡å ï¼Œéœ€è¦æ˜ç¡®åˆ†å·¥

---

### 1.3 ä¼˜å…ˆçº§ç®¡ç†æ··ä¹±

**å½“å‰é…ç½®ï¼š**
```typescript
// SuggestionArbiter.ts
const fimSuggestion: FimSuggestion = {
  type: 'FIM',
  priority: 1,  // ä½ä¼˜å…ˆçº§
  ...suggestion
};

const nesSuggestion: NesSuggestion = {
  type: 'NES',
  priority: 2,  // é«˜ä¼˜å…ˆçº§
  ...suggestion
};
```

**é—®é¢˜ï¼š**
- ä¼˜å…ˆçº§æ•°å­—è¶Šå¤§è¶Šé«˜ï¼Œä½† FIM åº”è¯¥ä¼˜å…ˆï¼ˆå®æ—¶è¡¥å…¨ï¼‰
- NES åº”è¯¥åœ¨ FIM æ— æ³•å¤„ç†æ—¶æ‰ä»‹å…¥
- å½“å‰é€»è¾‘å¯¼è‡´ NES æ€»æ˜¯è¦†ç›– FIM

**æ­£ç¡®çš„ä¼˜å…ˆçº§ï¼š**
```typescript
FIM: priority: 2      // é«˜ä¼˜å…ˆçº§ï¼ˆå®æ—¶è¡¥å…¨ï¼‰
NES: priority: 1      // ä½ä¼˜å…ˆçº§ï¼ˆç¼–è¾‘é¢„æµ‹ï¼‰
WORD_FIX: priority: 3 // æœ€é«˜ä¼˜å…ˆçº§ï¼ˆæ‹¼å†™ä¿®æ­£ï¼‰
```

---

### 1.4 Tab é”®å¤„ç†å¤æ‚

**å½“å‰æµç¨‹ï¼š**
```
ç”¨æˆ·ç¼–è¾‘ â†’ NES é¢„æµ‹ â†’ æ˜¾ç¤º Glyph Icon
  â†“
ç”¨æˆ·æŒ‰ Tab (ç¬¬1æ¬¡) â†’ è·³è½¬åˆ°å»ºè®®è¡Œ
  â†“
ç”¨æˆ·æŒ‰ Tab (ç¬¬2æ¬¡) â†’ å±•å¼€ ViewZone é¢„è§ˆ
  â†“
ç”¨æˆ·æŒ‰ Tab (ç¬¬3æ¬¡) â†’ åº”ç”¨å»ºè®®
```

**é—®é¢˜ï¼š**
- éœ€è¦ 3 æ¬¡ Tabï¼Œç”¨æˆ·ä½“éªŒå·®
- ç”¨æˆ·ä¸æ¸…æ¥šå½“å‰çŠ¶æ€ï¼ˆè·³è½¬ï¼Ÿé¢„è§ˆï¼Ÿåº”ç”¨ï¼Ÿï¼‰
- ViewZone é¢„è§ˆå ç”¨ç©ºé—´ï¼Œå¹²æ‰°ç¼–è¾‘

**GitHub Copilot çš„æµç¨‹ï¼š**
```
ç”¨æˆ·ç¼–è¾‘ â†’ NES é¢„æµ‹ â†’ æ˜¾ç¤ºç®­å¤´ + ç°è‰²æ–‡æœ¬
  â†“
ç”¨æˆ·æŒ‰ Tab (ç¬¬1æ¬¡) â†’ è·³è½¬åˆ°å»ºè®®è¡Œï¼ˆç°è‰²æ–‡æœ¬å˜ä¸ºå¯è§ï¼‰
  â†“
ç”¨æˆ·æŒ‰ Tab (ç¬¬2æ¬¡) â†’ åº”ç”¨å»ºè®®
```

---

### 1.5 ç¼ºå°‘ä¸Šä¸‹æ–‡æ„ŸçŸ¥

**å½“å‰å®ç°ï¼š**
```typescript
// æ‰€æœ‰ç¼–è¾‘éƒ½è§¦å‘ NES
this.editor.onDidChangeModelContent((e) => {
  this.schedulePredict();  // æ— æ¡ä»¶è§¦å‘
});
```

**é—®é¢˜ï¼š**
- åˆ é™¤ç©ºæ ¼ä¹Ÿè§¦å‘é¢„æµ‹ï¼ˆæµªè´¹ï¼‰
- æ·»åŠ æ³¨é‡Šä¹Ÿè§¦å‘é¢„æµ‹ï¼ˆæ— æ„ä¹‰ï¼‰
- æ— æ³•åŒºåˆ†"é‡è¦ç¼–è¾‘"å’Œ"çç¢ç¼–è¾‘"

**åº”è¯¥æœ‰çš„åˆ¤æ–­ï¼š**
```typescript
function isSignificantEdit(change): boolean {
  // åªæœ‰é‡è¦ç¼–è¾‘æ‰è§¦å‘ NES
  if (isWhitespaceOnly(change)) return false;
  if (isCommentEdit(change)) return false;
  if (isMinorTypo(change)) return false;
  
  return true;
}
```

---

## äºŒã€ä¸šç•Œæœ€ä½³å®è·µ

### 2.1 GitHub Copilot

#### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GitHub Copilot æ¶æ„             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Inline       â”‚    â”‚ Next Edit    â”‚  â”‚
â”‚  â”‚ Completion   â”‚    â”‚ Suggestions  â”‚  â”‚
â”‚  â”‚ (å®æ—¶)       â”‚    â”‚ (åˆ†ææ¨¡å¼)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚          â”‚
â”‚         â”‚                    â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Suggestion Arbiter          â”‚  â”‚
â”‚  â”‚      (ä¼˜å…ˆçº§ç®¡ç†)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§¦å‘é€»è¾‘
```typescript
// Inline Completion (FIM)
- è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·åœæ­¢æ‰“å­— 200-500ms
- è§¦å‘é¢‘ç‡ï¼šé«˜é¢‘ï¼ˆæ¯æ¬¡åœé¡¿ï¼‰
- æ˜¾ç¤ºæ–¹å¼ï¼šç°è‰²æ–‡æœ¬ï¼ˆinline ghost textï¼‰
- æ¥å—æ–¹å¼ï¼šTab é”®
- å–æ¶ˆæ–¹å¼ï¼šç»§ç»­æ‰“å­— / Esc

// Next Edit Suggestions (NES)
- è§¦å‘æ¡ä»¶ï¼šæ£€æµ‹åˆ°"é‡è¦ç¼–è¾‘æ¨¡å¼"
  * å‡½æ•°ç­¾åä¿®æ”¹
  * å˜é‡é‡å‘½å
  * ç±»å‹å®šä¹‰ä¿®æ”¹
- è§¦å‘é¢‘ç‡ï¼šä½é¢‘ï¼ˆåªåœ¨ç‰¹å®šæ¨¡å¼ä¸‹ï¼‰
- æ˜¾ç¤ºæ–¹å¼ï¼šç®­å¤´ + ç°è‰²æ–‡æœ¬ + åˆ é™¤çº¿
- æ¥å—æ–¹å¼ï¼šTab è·³è½¬ â†’ Tab æ¥å—
- å–æ¶ˆæ–¹å¼ï¼šEsc / ç»§ç»­ç¼–è¾‘å…¶ä»–ä½ç½®
```

#### ä¸‰ç§ NES UI æ¨¡å¼ï¼ˆåŸºäº NesEditor.vue å®ç°ï¼‰

```typescript
// åœºæ™¯ 1ï¼šä¸‰å…ƒè¡¨è¾¾å¼é”™è¯¯ï¼ˆæ•´è¡Œæ›¿æ¢ï¼‰
æ˜¾ç¤ºï¼šæ•´è¡Œçº¢è‰²èƒŒæ™¯ + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆViewZoneï¼‰
å›¾æ ‡ï¼šâš¡ (lightning bolt)
äº¤äº’ï¼šTab è·³è½¬ â†’ Tab æ¥å—
é€‚ç”¨ï¼šé€»è¾‘é”™è¯¯ä¿®æ­£ï¼ˆå¦‚ä¸‰å…ƒè¡¨è¾¾å¼é”™è¯¯ï¼‰
å®ç°çŠ¶æ€ï¼šâœ… å·²åœ¨ NesEditor.vue ä¸­å®ç°

// åœºæ™¯ 2ï¼šæ’å…¥å±æ€§ï¼ˆæ’å…¥æ–°è¡Œï¼‰
æ˜¾ç¤ºï¼šæ•´è¡Œè“è‰²èƒŒæ™¯ + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆViewZoneï¼‰
å›¾æ ‡ï¼šğŸ’¡ (lightbulb)
äº¤äº’ï¼šTab è·³è½¬ â†’ Tab æ¥å—
é€‚ç”¨ï¼šæ·»åŠ æ–°å±æ€§ã€æ–°æ–¹æ³•
å®ç°çŠ¶æ€ï¼šâœ… å·²åœ¨ NesEditor.vue ä¸­å®ç°

// åœºæ™¯ 3ï¼šå•è¯/éƒ¨åˆ†æ›¿æ¢
æ˜¾ç¤ºï¼šåªé«˜äº®é”™è¯¯å•è¯ + è¡Œå†…ç®­å¤´ï¼ˆâ†³ï¼‰+ é¢„è§ˆå•è¯
å›¾æ ‡ï¼šâš¡ (lightning bolt)
äº¤äº’ï¼šTab è·³è½¬ â†’ Tab æ¥å—
é€‚ç”¨ï¼š
  - å…³é”®å­—æ‹¼å†™é”™è¯¯ï¼ˆfunct ion â†’ functionï¼‰
  - é€»è¾‘è¿ç®—ç¬¦é”™è¯¯ï¼ˆ|| â†’ &&ï¼‰
  - å˜é‡é‡å‘½åï¼ˆname â†’ userNameï¼‰
  - å­—ç¬¦ä¸²å€¼ä¿®æ­£ï¼ˆ'Hello' â†’ 'Goodbye'ï¼‰
å®ç°çŠ¶æ€ï¼šâœ… å·²åœ¨ NesEditor.vue ä¸­å®ç°

// åœºæ™¯ 4ï¼šåˆ é™¤è¡Œï¼ˆå¾…å®ç°ï¼‰
æ˜¾ç¤ºï¼šæ•´è¡Œçº¢è‰²èƒŒæ™¯ + åˆ é™¤çº¿
å›¾æ ‡ï¼šâš ï¸ (warning)
äº¤äº’ï¼šTab è·³è½¬ â†’ Tab åˆ é™¤
é€‚ç”¨ï¼š
  - åˆ é™¤æ— ç”¨çš„å¯¼å…¥è¯­å¥
  - åˆ é™¤é‡å¤çš„ä»£ç è¡Œ
  - åˆ é™¤è¿‡æ—¶çš„æ³¨é‡Š
å®ç°çŠ¶æ€ï¼šâŒ å¾…åœ¨ NesEditor.vue ä¸­å®ç°
```

**UI æ•ˆæœå¯¹æ¯”ï¼š**

| åœºæ™¯ | é”™è¯¯æ ‡è®° | é¢„è§ˆæ–¹å¼ | å¯¹åº”æˆªå›¾ | å®ç°çŠ¶æ€ |
|------|----------|----------|----------|----------|
| åœºæ™¯1ï¼šä¸‰å…ƒè¡¨è¾¾å¼ | æ•´è¡Œçº¢è‰²èƒŒæ™¯ | æ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆViewZoneï¼‰ | image-1.png | âœ… å·²å®ç° |
| åœºæ™¯2ï¼šæ’å…¥å±æ€§ | æ•´è¡Œè“è‰²èƒŒæ™¯ | æ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆViewZoneï¼‰ | image-3.png | âœ… å·²å®ç° |
| åœºæ™¯3ï¼šå•è¯æ›¿æ¢ | åªé«˜äº®å•è¯ | è¡Œå†…ç®­å¤´ + é¢„è§ˆå•è¯ | image-2.png, image-4.png | âœ… å·²å®ç° |
| åœºæ™¯4ï¼šåˆ é™¤è¡Œ | æ•´è¡Œçº¢è‰²èƒŒæ™¯ + åˆ é™¤çº¿ | æ— é¢„è§ˆï¼ˆç›´æ¥åˆ é™¤ï¼‰ | - | âŒ å¾…å®ç° |

---

### 2.2 Cursor AI

#### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cursor AI æ¶æ„                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tab          â”‚    â”‚ Cmd+K        â”‚  â”‚
â”‚  â”‚ Autocomplete â”‚    â”‚ AI Edit      â”‚  â”‚
â”‚  â”‚ (å®æ—¶)       â”‚    â”‚ (æ‰‹åŠ¨è§¦å‘)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚          â”‚
â”‚         â”‚                    â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Context Manager             â”‚  â”‚
â”‚  â”‚      (ä¸Šä¸‹æ–‡ç®¡ç†)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§¦å‘é€»è¾‘
```typescript
// Tab Autocomplete (FIM)
- è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·åœæ­¢æ‰“å­— 300ms
- è§¦å‘é¢‘ç‡ï¼šé«˜é¢‘
- æ˜¾ç¤ºæ–¹å¼ï¼šç°è‰²æ–‡æœ¬
- æ¥å—æ–¹å¼ï¼šTab é”®
- ç‰¹ç‚¹ï¼šåªè¡¥å…¨å½“å‰å…‰æ ‡ä½ç½®

// Cmd+K AI Edit (Chat-based)
- è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·æ‰‹åŠ¨æŒ‰ Cmd+K
- è§¦å‘é¢‘ç‡ï¼šä½é¢‘ï¼ˆç”¨æˆ·ä¸»åŠ¨ï¼‰
- æ˜¾ç¤ºæ–¹å¼ï¼šå¼¹å‡ºè¾“å…¥æ¡†
- æ¥å—æ–¹å¼ï¼šç”¨æˆ·è¾“å…¥æŒ‡ä»¤ â†’ AI æ‰§è¡Œ
- ç‰¹ç‚¹ï¼šå¯ä»¥è·¨æ–‡ä»¶ã€å¤šè¡Œç¼–è¾‘
```

---

### 2.3 Continue

#### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Continue æ¶æ„                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Autocomplete â”‚    â”‚ Next Edit    â”‚  â”‚
â”‚  â”‚ (å¯é€‰)       â”‚    â”‚ (å¯é€‰)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚          â”‚
â”‚         â”‚                    â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      User Settings               â”‚  â”‚
â”‚  â”‚      (ç”¨æˆ·å¯é…ç½®)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§¦å‘é€»è¾‘
```typescript
// Autocomplete (FIM)
- è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·é…ç½®ï¼ˆé»˜è®¤å…³é—­ï¼‰
- è§¦å‘é¢‘ç‡ï¼šé«˜é¢‘
- æ˜¾ç¤ºæ–¹å¼ï¼šç°è‰²æ–‡æœ¬
- æ¥å—æ–¹å¼ï¼šTab é”®

// Next Edit (NES)
- è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·é…ç½®ï¼ˆé»˜è®¤å…³é—­ï¼‰
- è§¦å‘é¢‘ç‡ï¼šä½é¢‘
- æ˜¾ç¤ºæ–¹å¼ï¼šç®­å¤´ + ç°è‰²æ–‡æœ¬
- æ¥å—æ–¹å¼ï¼šTab è·³è½¬ â†’ Tab æ¥å—
- ç‰¹ç‚¹ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©å¯ç”¨/ç¦ç”¨
```

---

## ä¸‰ã€æ¨èæ–¹æ¡ˆ

### 3.1 å®Œå…¨åˆ†ç¦» FIM å’Œ NES è§¦å‘é€»è¾‘

#### æ–¹æ¡ˆ Aï¼šåŸºäºç¼–è¾‘æ¨¡å¼åˆ¤æ–­ï¼ˆæ¨èï¼‰

```typescript
// ç¼–è¾‘æ¨¡å¼æšä¸¾
enum EditMode {
  TYPING,        // æ­£å¸¸æ‰“å­—ï¼ˆè§¦å‘ FIMï¼‰
  REFACTORING,   // é‡æ„æ¨¡å¼ï¼ˆè§¦å‘ NESï¼‰
  IDLE,          // ç©ºé—²ï¼ˆä¸è§¦å‘ï¼‰
}

class EditModeDetector {
  private mode: EditMode = EditMode.IDLE;
  private editHistory: Edit[] = [];
  
  detectMode(change: ContentChange): EditMode {
    this.editHistory.push(change);
    
    // æ£€æµ‹é‡æ„æ¨¡å¼
    if (this.isRefactoringPattern()) {
      return EditMode.REFACTORING;
    }
    
    // æ£€æµ‹æ­£å¸¸æ‰“å­—
    if (this.isTypingPattern()) {
      return EditMode.TYPING;
    }
    
    return EditMode.IDLE;
  }
  
  private isRefactoringPattern(): boolean {
    // æ£€æµ‹å‡½æ•°ç­¾åä¿®æ”¹
    if (this.hasFunctionSignatureChange()) return true;
    
    // æ£€æµ‹å˜é‡é‡å‘½å
    if (this.hasVariableRename()) return true;
    
    // æ£€æµ‹ç±»å‹å®šä¹‰ä¿®æ”¹
    if (this.hasTypeDefinitionChange()) return true;
    
    return false;
  }
  
  private isTypingPattern(): boolean {
    // æ£€æµ‹è¿ç»­çš„å°ç¼–è¾‘
    if (this.hasConsecutiveSmallEdits()) return true;
    
    // æ£€æµ‹å•è¡Œç¼–è¾‘
    if (this.isSingleLineEdit()) return true;
    
    return false;
  }
}

// ä½¿ç”¨
this.editor.onDidChangeModelContent((e) => {
  const mode = this.modeDetector.detectMode(e);
  
  if (mode === EditMode.TYPING) {
    // åªè§¦å‘ FIM
    this.fimProvider.trigger();
  } else if (mode === EditMode.REFACTORING) {
    // åªè§¦å‘ NES
    this.nesController.predict();
  }
});
```

#### æ–¹æ¡ˆ Bï¼šåŸºäºæ—¶é—´çª—å£ï¼ˆç®€å•ï¼‰

```typescript
class TriggerManager {
  private lastFimTrigger = 0;
  private lastNesTrigger = 0;
  
  private FIM_COOLDOWN = 500;   // FIM å†·å´ 500ms
  private NES_COOLDOWN = 1500;  // NES å†·å´ 1500ms
  
  shouldTriggerFim(): boolean {
    const now = Date.now();
    if (now - this.lastFimTrigger < this.FIM_COOLDOWN) {
      return false;
    }
    this.lastFimTrigger = now;
    return true;
  }
  
  shouldTriggerNes(change: ContentChange): boolean {
    const now = Date.now();
    
    // NES åªåœ¨é‡è¦ç¼–è¾‘æ—¶è§¦å‘
    if (!this.isSignificantEdit(change)) {
      return false;
    }
    
    if (now - this.lastNesTrigger < this.NES_COOLDOWN) {
      return false;
    }
    
    this.lastNesTrigger = now;
    return true;
  }
  
  private isSignificantEdit(change: ContentChange): boolean {
    // å¿½ç•¥ç©ºç™½å­—ç¬¦ç¼–è¾‘
    if (/^\s*$/.test(change.text)) return false;
    
    // å¿½ç•¥å•å­—ç¬¦ç¼–è¾‘
    if (change.text.length === 1) return false;
    
    // å¿½ç•¥æ³¨é‡Šç¼–è¾‘
    if (change.text.startsWith('//') || change.text.startsWith('/*')) return false;
    
    return true;
  }
}
```

---

### 3.2 è°ƒæ•´ä¼˜å…ˆçº§

```typescript
// ä¿®æ­£ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§è¶Šé«˜ï¼‰
const PRIORITIES = {
  WORD_FIX: 3,  // æœ€é«˜ä¼˜å…ˆçº§ï¼ˆæ‹¼å†™ä¿®æ­£ï¼‰
  FIM: 2,       // é«˜ä¼˜å…ˆçº§ï¼ˆå®æ—¶è¡¥å…¨ï¼‰
  NES: 1,       // ä½ä¼˜å…ˆçº§ï¼ˆç¼–è¾‘é¢„æµ‹ï¼‰
};

// SuggestionArbiter.ts
submitFimSuggestion(suggestion: Omit<FimSuggestion, 'type' | 'priority'>): boolean {
  const fimSuggestion: FimSuggestion = {
    type: 'FIM',
    priority: PRIORITIES.FIM,  // æ”¹ä¸º 2
    ...suggestion
  };
  return this.acceptSuggestion(fimSuggestion);
}

submitNesSuggestion(suggestion: Omit<NesSuggestion, 'type' | 'priority'>): boolean {
  const nesSuggestion: NesSuggestion = {
    type: 'NES',
    priority: PRIORITIES.NES,  // æ”¹ä¸º 1
    ...suggestion
  };
  return this.acceptSuggestion(nesSuggestion);
}
```

---

### 3.3 ç®€åŒ– Tab é”®é€»è¾‘ï¼ˆå·²åœ¨ NesEditor.vue ä¸­å®ç°ï¼‰

#### å½“å‰æµç¨‹ï¼ˆ2 æ¬¡ Tab - å·²ä¼˜åŒ–ï¼‰
```
çŠ¶æ€ 1ï¼šå»ºè®®å‡ºç°
  - æ˜¾ç¤ºç®­å¤´å›¾æ ‡ï¼ˆGlyph Marginï¼‰
  - æ˜¾ç¤ºé”™è¯¯æ ‡è®°ï¼ˆçº¢è‰²/è“è‰²èƒŒæ™¯ï¼‰

Tab 1: è·³è½¬åˆ°å»ºè®®è¡Œ + æ˜¾ç¤ºé¢„è§ˆ
  - åœºæ™¯1/2ï¼šæ˜¾ç¤ºæ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆViewZoneï¼‰
  - åœºæ™¯3ï¼šæ˜¾ç¤ºè¡Œå†…ç®­å¤´ + é¢„è§ˆå•è¯

Tab 2: åº”ç”¨å»ºè®®
  - åœºæ™¯1ï¼šæ›¿æ¢æ•´è¡Œ
  - åœºæ™¯2ï¼šæ’å…¥æ–°è¡Œ
  - åœºæ™¯3ï¼šæ›¿æ¢å•è¯/éƒ¨åˆ†å†…å®¹
```

#### NesEditor.vue å®ç°ç»†èŠ‚

**åœºæ™¯ 1ï¼šä¸‰å…ƒè¡¨è¾¾å¼é”™è¯¯ï¼ˆæ•´è¡Œæ›¿æ¢ï¼‰**
```typescript
// çŠ¶æ€ 1ï¼šæ˜¾ç¤ºç®­å¤´ + çº¢è‰²é«˜äº®
showState1Internal(arrowLine, errorLine, 'âš¡', 'ä¿®æ­£é€»è¾‘é”™è¯¯');

// çŠ¶æ€ 2ï¼šæ˜¾ç¤ºæ•´è¡Œé¢„è§ˆï¼ˆViewZoneï¼‰
editorRef.value.changeViewZones((changeAccessor) => {
  const domNode = document.createElement('div');
  domNode.className = 'nes-demo-preview-zone';  // æµ…ç»¿è‰²èƒŒæ™¯ + ç°è‰²æ–‡æœ¬
  domNode.textContent = suggestionText;
  
  currentViewZoneId = changeAccessor.addZone({
    afterLineNumber: errorLine,  // åœ¨é”™è¯¯è¡Œä¸‹æ–¹æ’å…¥
    heightInLines: 1,
    domNode: domNode
  });
});
```

**åœºæ™¯ 2ï¼šæ’å…¥å±æ€§ï¼ˆæ’å…¥æ–°è¡Œï¼‰**
```typescript
// çŠ¶æ€ 1ï¼šæ˜¾ç¤ºç®­å¤´ + è“è‰²é«˜äº®
showState1Internal(arrowLine, arrowLine, 'ğŸ’¡', 'æ·»åŠ  z å±æ€§');

// çŠ¶æ€ 2ï¼šæ˜¾ç¤ºæ•´è¡Œé¢„è§ˆï¼ˆViewZoneï¼‰
editorRef.value.changeViewZones((changeAccessor) => {
  const domNode = document.createElement('div');
  domNode.className = 'nes-demo-preview-zone-insert';  // æµ…ç»¿è‰²èƒŒæ™¯ + ç°è‰²æ–‡æœ¬
  domNode.textContent = suggestionText;
  
  currentViewZoneId = changeAccessor.addZone({
    afterLineNumber: insertAfterLine,  // åœ¨æŒ‡å®šè¡Œä¸‹æ–¹æ’å…¥
    heightInLines: 1,
    domNode: domNode
  });
});
```

**åœºæ™¯ 3ï¼šå•è¯/éƒ¨åˆ†æ›¿æ¢ï¼ˆè¡Œå†…ç®­å¤´ï¼‰**
```typescript
// çŠ¶æ€ 1ï¼šåªé«˜äº®é”™è¯¯å•è¯
highlightDecorations = editorRef.value.deltaDecorations([], [{
  range: new monaco.Range(errorLine, wordStartColumn, errorLine, wordEndColumn),
  options: {
    inlineClassName: 'nes-demo-error-word-highlight'  // çº¢è‰²èƒŒæ™¯ + è¾¹æ¡†
  }
}]);

// çŠ¶æ€ 2ï¼šæ˜¾ç¤ºè¡Œå†…ç®­å¤´ + é¢„è§ˆå•è¯ï¼ˆViewZoneï¼‰
editorRef.value.changeViewZones((changeAccessor) => {
  const domNode = document.createElement('div');
  domNode.className = 'nes-demo-preview-zone-word-only';
  
  // è®¡ç®—å¯¹é½ä½ç½®
  const leadingSpaces = ' '.repeat(wordStartIndex);
  
  // åˆ›å»ºå‰å¯¼ç©ºæ ¼
  const spacingSpan = document.createElement('span');
  spacingSpan.textContent = leadingSpaces;
  
  // åˆ›å»ºç®­å¤´ï¼ˆSVGï¼‰
  const arrowSpan = document.createElement('span');
  arrowSpan.className = 'nes-demo-arrow';
  arrowSpan.innerHTML = ArrowTurnDownRightIcon;  // â†³ ç®­å¤´å›¾æ ‡
  
  // åˆ›å»ºé¢„è§ˆå•è¯ï¼ˆå¸¦èƒŒæ™¯ï¼‰
  const previewSpan = document.createElement('span');
  previewSpan.className = 'nes-demo-preview-word-with-bg';
  previewSpan.textContent = ' ' + correctWord;
  
  domNode.appendChild(spacingSpan);
  domNode.appendChild(arrowSpan);
  domNode.appendChild(previewSpan);
  
  currentViewZoneId = changeAccessor.addZone({
    afterLineNumber: errorLine,
    heightInLines: 1,
    domNode: domNode
  });
});
```

---

### 3.4 UI æ ·å¼å®ç°ï¼ˆåŸºäº NesEditor.vueï¼‰

#### CSS æ ·å¼å®šä¹‰

```css
/* ==================== åœºæ™¯ 1 & 2ï¼šæ•´è¡Œæ›¿æ¢/æ’å…¥ ==================== */

/* çº¢è‰²é«˜äº®ï¼ˆåœºæ™¯1ï¼šé”™è¯¯æ ‡è®°ï¼Œæ•´è¡ŒèƒŒæ™¯ï¼‰ */
:deep(.nes-demo-error-highlight) {
  background-color: rgba(255, 0, 0, 0.15) !important;  /* çº¢è‰²èƒŒæ™¯ */
}

/* è“è‰²é«˜äº®ï¼ˆåœºæ™¯2ï¼šæ’å…¥ä½ç½®ï¼Œæ•´è¡ŒèƒŒæ™¯ï¼‰ */
:deep(.nes-demo-insert-highlight) {
  background-color: rgba(0, 122, 204, 0.1) !important;  /* è“è‰²èƒŒæ™¯ */
}

/* ViewZone é¢„è§ˆè¡Œï¼ˆåœºæ™¯1ï¼šREPLACE æ¨¡å¼ - æ•´è¡Œé¢„è§ˆï¼‰ */
:deep(.nes-demo-preview-zone) {
  background-color: rgba(0, 255, 0, 0.08) !important;  /* æµ…ç»¿è‰²èƒŒæ™¯ */
  color: #858585 !important;  /* ç°è‰²æ–‡æœ¬ */
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 14px;
  line-height: 19px;
  padding-left: 0;
  margin-left: 0;
  font-style: italic;
  white-space: pre;  /* ä¿ç•™ç©ºç™½å­—ç¬¦ï¼ˆç¼©è¿›ï¼‰ */
}

/* ViewZone é¢„è§ˆè¡Œï¼ˆåœºæ™¯2ï¼šINSERT æ¨¡å¼ - æ•´è¡Œé¢„è§ˆï¼‰ */
:deep(.nes-demo-preview-zone-insert) {
  background-color: rgba(0, 255, 0, 0.08) !important;  /* æµ…ç»¿è‰²èƒŒæ™¯ */
  color: #858585 !important;  /* ç°è‰²æ–‡æœ¬ */
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 14px;
  line-height: 19px;
  padding-left: 0;
  margin-left: 0;
  font-style: italic;
  white-space: pre;  /* ä¿ç•™ç©ºç™½å­—ç¬¦ï¼ˆç¼©è¿›ï¼‰ */
}

/* ==================== åœºæ™¯ 3ï¼šå•è¯/éƒ¨åˆ†æ›¿æ¢ ==================== */

/* çº¢è‰²é«˜äº®ï¼ˆåªé«˜äº®å•è¯ï¼Œå˜é‡é‡å‘½å/å•è¯æ‹¼å†™é”™è¯¯åœºæ™¯ï¼‰
 * é€‚ç”¨åœºæ™¯ï¼š
 * - å˜é‡é‡å‘½åï¼šå˜é‡åä¿®æ”¹
 * - å­—ç¬¦ä¸²å€¼ä¿®æ­£ï¼šå­—ç¬¦ä¸²å†…å®¹ä¿®æ”¹
 * - å•è¯æ‹¼å†™é”™è¯¯ï¼šæ‹¼å†™é”™è¯¯ä¿®æ­£
 * - é€»è¾‘è¿ç®—ç¬¦é”™è¯¯ï¼š|| â†’ &&
 */
:deep(.nes-demo-error-word-highlight) {
  background-color: rgba(255, 0, 0, 0.25) !important;  /* çº¢è‰²èƒŒæ™¯ */
  border-radius: 3px;
  padding: 2px 4px;
  border: 1px solid rgba(255, 0, 0, 0.3);  /* çº¢è‰²è¾¹æ¡† */
}

/* ç®­å¤´æ ·å¼ï¼ˆSVGï¼‰ */
:deep(.nes-demo-arrow) {
  display: inline-flex;
  align-items: center;
  vertical-align: middle;
}

:deep(.nes-demo-arrow svg) {
  color: #ffffff;
  width: 16px;
  height: 16px;
  vertical-align: middle;
}

/* é¢„è§ˆå•è¯æ ·å¼ï¼ˆå¸¦èƒŒæ™¯ï¼Œå˜é‡é‡å‘½ååœºæ™¯ï¼‰ */
:deep(.nes-demo-preview-word-with-bg) {
  background-color: rgba(0, 255, 0, 0.15);
  color: #667de8;
  font-style: italic;
  border-radius: 3px;
  padding: 2px;
  margin-left: 4px;
  border: 1px solid rgba(0, 255, 0, 0.25);
}

/* ViewZone é¢„è§ˆè¡Œï¼ˆåªæ˜¾ç¤ºå•è¯ï¼Œå˜é‡é‡å‘½å/å•è¯æ‹¼å†™é”™è¯¯åœºæ™¯ï¼‰
 * å¸ƒå±€è¯´æ˜ï¼š
 * - ä½¿ç”¨ leadingSpaces ç²¾ç¡®å¯¹é½åˆ°é”™è¯¯å•è¯ä½ç½®
 * - ä¸ä½¿ç”¨ margin-leftï¼Œé¿å…åŒé‡åç§»
 * - ç®­å¤´å’Œé¢„è§ˆå•è¯é€šè¿‡ DOM ç»“æ„æ§åˆ¶ä½ç½®
 */
:deep(.nes-demo-preview-zone-word-only) {
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 14px;
  line-height: 19px;
  padding-left: 0;
  margin-top: 4px;
  margin-left: 0;  /* ç§»é™¤é¢å¤–çš„ marginï¼Œä½¿ç”¨ leadingSpaces å¯¹é½ */
  white-space: pre;
}

/* ==================== Glyph Iconï¼ˆç®­å¤´å›¾æ ‡ï¼‰ ==================== */

/* Glyph Iconï¼ˆç´«è‰²ç®­å¤´å›¾æ ‡ - REPLACE æ¨¡å¼ï¼‰ */
:deep(.nes-demo-glyph.replace::before) {
  content: 'â†’';
  font-size: 18px;
  font-weight: bold;
  color: #c586c0;  /* ç´«è‰²ç®­å¤´ */
  cursor: pointer;
}

/* Glyph Iconï¼ˆé’è‰²ç®­å¤´å›¾æ ‡ - INSERT æ¨¡å¼ï¼‰ */
:deep(.nes-demo-glyph.insert::before) {
  content: 'â†’';
  font-size: 18px;
  font-weight: bold;
  color: #4ec9b0;  /* é’è‰²ç®­å¤´ï¼ˆINSERT æ¨¡å¼ï¼‰ */
  cursor: pointer;
}
```

#### å…³é”®è®¾è®¡å†³ç­–

1. **åœºæ™¯ 1 & 2 ä½¿ç”¨ ViewZone**
   - åŸå› ï¼šéœ€è¦æ˜¾ç¤ºæ•´è¡Œé¢„è§ˆï¼ŒViewZone å¯ä»¥åœ¨ä¸å½±å“åŸä»£ç çš„æƒ…å†µä¸‹æ’å…¥æ–°è¡Œ
   - ä¼˜ç‚¹ï¼šé¢„è§ˆå†…å®¹æ¸…æ™°ï¼Œä¸å¹²æ‰°åŸä»£ç 
   - ç¼ºç‚¹ï¼šå ç”¨é¢å¤–ç©ºé—´

2. **åœºæ™¯ 3 ä½¿ç”¨è¡Œå†…ç®­å¤´ + ViewZone**
   - åŸå› ï¼šåªéœ€è¦é¢„è§ˆå•è¯ï¼Œä¸éœ€è¦æ•´è¡Œ
   - ä¼˜ç‚¹ï¼šç²¾ç¡®å¯¹é½ï¼Œè§†è§‰æ•ˆæœå¥½
   - å®ç°ï¼šä½¿ç”¨ `leadingSpaces` è®¡ç®—å¯¹é½ä½ç½®ï¼Œé¿å…ä½¿ç”¨ `margin-left`

3. **é¢œè‰²æ–¹æ¡ˆ**
   - çº¢è‰²èƒŒæ™¯ï¼šé”™è¯¯æ ‡è®°ï¼ˆåœºæ™¯ 1ï¼‰
   - è“è‰²èƒŒæ™¯ï¼šæ’å…¥ä½ç½®ï¼ˆåœºæ™¯ 2ï¼‰
   - ç»¿è‰²èƒŒæ™¯ï¼šé¢„è§ˆå†…å®¹ï¼ˆæ‰€æœ‰åœºæ™¯ï¼‰
   - ç°è‰²æ–‡æœ¬ï¼šé¢„è§ˆæ–‡æœ¬ï¼ˆåœºæ™¯ 1 & 2ï¼‰
   - ç´«è‰²ç®­å¤´ï¼šGlyph Iconï¼ˆREPLACE æ¨¡å¼ï¼‰
   - é’è‰²ç®­å¤´ï¼šGlyph Iconï¼ˆINSERT æ¨¡å¼ï¼‰

---

### 3.5 å®ç° Insert/Replace/Delete ä¸‰ç§æ¨¡å¼

```typescript
// types/nes.ts
export type ChangeType = 'INSERT' | 'REPLACE' | 'DELETE';

export interface Prediction {
  targetLine: number;
  originalLineContent: string;
  suggestionText: string;
  explanation: string;
  confidence: number;
  priority: number;
  changeType: ChangeType;  // ğŸ†• æ–°å¢å­—æ®µ
}

// NESController.ts
private validatePrediction(pred: Prediction): boolean {
  const model = this.editor.getModel();
  if (!model) return false;

  const actualLine = model.getLineContent(pred.targetLine);
  
  // æ ¹æ® changeType åˆ¤æ–­
  if (pred.changeType === 'INSERT') {
    // æ’å…¥æ¨¡å¼ï¼šç›®æ ‡è¡Œåº”è¯¥ä¸ºç©ºæˆ–åªæœ‰ç©ºç™½
    return /^\s*$/.test(actualLine);
  } else if (pred.changeType === 'REPLACE') {
    // æ›¿æ¢æ¨¡å¼ï¼šç›®æ ‡è¡Œåº”è¯¥ä¸ originalLineContent åŒ¹é…
    const normalize = (s: string) => s.replace(/\s+/g, ' ').trim();
    return normalize(actualLine) === normalize(pred.originalLineContent);
  } else if (pred.changeType === 'DELETE') {
    // åˆ é™¤æ¨¡å¼ï¼šç›®æ ‡è¡Œåº”è¯¥å­˜åœ¨ä¸”ä¸ originalLineContent åŒ¹é…
    const normalize = (s: string) => s.replace(/\s+/g, ' ').trim();
    return normalize(actualLine) === normalize(pred.originalLineContent);
  }
  
  return true;
}
```

**å·²åœ¨ NesEditor.vue ä¸­å®ç°çš„åœºæ™¯ï¼š**

| åœºæ™¯ | ChangeType | UI ç‰¹å¾ | ç¤ºä¾‹ | å®ç°çŠ¶æ€ |
|------|-----------|---------|------|----------|
| åœºæ™¯1ï¼šä¸‰å…ƒè¡¨è¾¾å¼ | REPLACE | æ•´è¡Œçº¢è‰² + æ•´è¡Œç»¿è‰²é¢„è§ˆ | `a > b ? b : a` â†’ `a > b ? a : b` | âœ… å·²å®ç° |
| åœºæ™¯2ï¼šæ’å…¥å±æ€§ | INSERT | æ•´è¡Œè“è‰² + æ•´è¡Œç»¿è‰²é¢„è§ˆ | æ·»åŠ  `z: number;` | âœ… å·²å®ç° |
| åœºæ™¯3ï¼šå•è¯æ›¿æ¢ | REPLACE | åªé«˜äº®å•è¯ + è¡Œå†…ç®­å¤´ | `funct ion` â†’ `function` | âœ… å·²å®ç° |
| åœºæ™¯3Bï¼šè¿ç®—ç¬¦ | REPLACE | åªé«˜äº®è¿ç®—ç¬¦ + è¡Œå†…ç®­å¤´ | `\|\|` â†’ `&&` | âœ… å·²å®ç° |
| åœºæ™¯4ï¼šåˆ é™¤è¡Œ | DELETE | æ•´è¡Œçº¢è‰² + åˆ é™¤çº¿ | åˆ é™¤æ— ç”¨ä»£ç  | âŒ å¾…å®ç° |

**DELETE æ¨¡å¼çš„é¢„æœŸ UI æ•ˆæœï¼š**
- é”™è¯¯æ ‡è®°ï¼šæ•´è¡Œçº¢è‰²èƒŒæ™¯ + åˆ é™¤çº¿
- é¢„è§ˆæ–¹å¼ï¼šæ— é¢„è§ˆï¼ˆç›´æ¥åˆ é™¤ï¼‰
- å›¾æ ‡ï¼šâš ï¸ (warning)
- äº¤äº’ï¼šTab è·³è½¬ â†’ Tab åˆ é™¤
- é€‚ç”¨åœºæ™¯ï¼š
  - åˆ é™¤æ— ç”¨çš„å¯¼å…¥è¯­å¥
  - åˆ é™¤é‡å¤çš„ä»£ç è¡Œ
  - åˆ é™¤è¿‡æ—¶çš„æ³¨é‡Š

---

### 3.6 æ·»åŠ è¯­ä¹‰åŒ–å›¾æ ‡

```typescript
// DecorationManager.ts
public renderGlyphIcon(line: number, explanation: string, changeType: ChangeType): void {
  const icon = this.getIconForChangeType(changeType);
  
  const decorations = [{
    range: new monaco.Range(line, 1, line, 1),
    options: {
      glyphMarginClassName: `nes-glyph-icon ${icon.className}`,
      glyphMarginHoverMessage: {
        value: `**${icon.label}**\n\n${explanation}`
      }
    }
  }];
  
  this.glyphDecorations = this.editor.deltaDecorations(
    this.glyphDecorations,
    decorations
  );
}

private getIconForChangeType(changeType: ChangeType): { className: string; label: string } {
  switch (changeType) {
    case 'INSERT':
      return { className: 'icon-insert', label: 'ğŸ’¡ Insert' };
    case 'REPLACE':
      return { className: 'icon-replace', label: 'âš¡ Replace' };
    case 'DELETE':
      return { className: 'icon-delete', label: 'âš ï¸ Delete' };
    default:
      return { className: 'icon-default', label: 'ğŸ“Œ Suggestion' };
  }
}
```

**å·²åœ¨ NesEditor.vue ä¸­å®ç°çš„å›¾æ ‡ï¼š**

```css
/* Glyph Iconï¼ˆç´«è‰²ç®­å¤´å›¾æ ‡ - REPLACE æ¨¡å¼ï¼‰ */
:deep(.nes-demo-glyph.replace::before) {
  content: 'â†’';
  font-size: 18px;
  font-weight: bold;
  color: #c586c0;  /* ç´«è‰²ç®­å¤´ */
  cursor: pointer;
}

/* Glyph Iconï¼ˆé’è‰²ç®­å¤´å›¾æ ‡ - INSERT æ¨¡å¼ï¼‰ */
:deep(.nes-demo-glyph.insert::before) {
  content: 'â†’';
  font-size: 18px;
  font-weight: bold;
  color: #4ec9b0;  /* é’è‰²ç®­å¤´ï¼ˆINSERT æ¨¡å¼ï¼‰ */
  cursor: pointer;
}
```

**å¾…å®ç°çš„ DELETE å›¾æ ‡ï¼š**

```css
/* Glyph Iconï¼ˆçº¢è‰²è­¦å‘Šå›¾æ ‡ - DELETE æ¨¡å¼ï¼‰ */
:deep(.nes-demo-glyph.delete::before) {
  content: 'âš ';
  font-size: 18px;
  font-weight: bold;
  color: #f48771;  /* çº¢è‰²è­¦å‘Š */
  cursor: pointer;
}
```

**å›¾æ ‡æ˜ å°„ï¼š**

| ChangeType | å›¾æ ‡ | é¢œè‰² | å«ä¹‰ | å®ç°çŠ¶æ€ |
|-----------|------|------|------|----------|
| REPLACE | â†’ | ç´«è‰² (#c586c0) | æ›¿æ¢ç°æœ‰ä»£ç  | âœ… å·²å®ç° |
| INSERT | â†’ | é’è‰² (#4ec9b0) | æ’å…¥æ–°å†…å®¹ | âœ… å·²å®ç° |
| DELETE | âš  | çº¢è‰² (#f48771) | åˆ é™¤ä»£ç  | âŒ å¾…å®ç° |

---

## å››ã€å®æ–½è®¡åˆ’

### Phase 1: åˆ†ç¦»è§¦å‘é€»è¾‘ï¼ˆ1-2å¤©ï¼‰
- [ ] å®ç° `isSignificantEdit()` åˆ¤æ–­
- [ ] æ·»åŠ  NES è§¦å‘æ¡ä»¶è¿‡æ»¤
- [ ] è°ƒæ•´ FIM å’Œ NES çš„å†·å´æ—¶é—´
- [ ] æµ‹è¯•è§¦å‘é¢‘ç‡

### Phase 2: è°ƒæ•´ä¼˜å…ˆçº§ï¼ˆ0.5å¤©ï¼‰
- [ ] ä¿®æ”¹ `SuggestionArbiter` ä¼˜å…ˆçº§é…ç½®
- [ ] æ›´æ–° `PRIORITIES` å¸¸é‡
- [ ] æµ‹è¯•ä¼˜å…ˆçº§å†²çªè§£å†³

### Phase 3: ç®€åŒ– Tab é”®é€»è¾‘ï¼ˆ1-2å¤©ï¼‰
- [ ] ç§»é™¤ ViewZone é¢„è§ˆ
- [ ] å®ç° Inline Ghost Text
- [ ] å®ç°åˆ é™¤çº¿è£…é¥°
- [ ] ç®€åŒ– Tab é”®å¤„ç†ï¼ˆ3æ¬¡ â†’ 2æ¬¡ï¼‰
- [ ] æµ‹è¯•äº¤äº’æµç¨‹

### Phase 4: å®ç° Insert/Replace æ¨¡å¼ï¼ˆ1å¤©ï¼‰
- [ ] æ·»åŠ  `changeType` å­—æ®µ
- [ ] æ›´æ–°åç«¯ Promptï¼ˆè¿”å› changeTypeï¼‰
- [ ] å®ç°ä¸åŒæ¨¡å¼çš„æ˜¾ç¤ºé€»è¾‘
- [ ] æµ‹è¯•æ¨¡å¼è¯†åˆ«

### Phase 5: æ·»åŠ è¯­ä¹‰åŒ–å›¾æ ‡ï¼ˆ0.5å¤©ï¼‰
- [ ] å®ç°å›¾æ ‡æ˜ å°„é€»è¾‘
- [ ] æ·»åŠ  CSS æ ·å¼
- [ ] æµ‹è¯•å›¾æ ‡æ˜¾ç¤º

### Phase 6: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•
- [ ] Bug ä¿®å¤

**æ€»è®¡ï¼š5-8 å¤©**

---

## äº”ã€éªŒæ”¶æ ‡å‡†ï¼ˆåŸºäº NesEditor.vue æ¼”ç¤ºï¼‰

### åŠŸèƒ½éªŒæ”¶
- âœ… FIM å’Œ NES ä¸å†åŒæ—¶è§¦å‘
- âœ… ä¼˜å…ˆçº§æ­£ç¡®ï¼ˆFIM > NESï¼‰
- âœ… Tab é”®åªéœ€ 2 æ¬¡ï¼ˆè·³è½¬ + é¢„è§ˆ â†’ åº”ç”¨ï¼‰
- âœ… **åœºæ™¯1ï¼šä¸‰å…ƒè¡¨è¾¾å¼é”™è¯¯**ï¼ˆæ•´è¡Œçº¢è‰² + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼‰- å·²åœ¨ NesEditor.vue ä¸­å®ç°
- âœ… **åœºæ™¯2ï¼šæ’å…¥å±æ€§**ï¼ˆæ•´è¡Œè“è‰² + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼‰- å·²åœ¨ NesEditor.vue ä¸­å®ç°
- âœ… **åœºæ™¯3ï¼šå•è¯/éƒ¨åˆ†æ›¿æ¢**ï¼ˆåªé«˜äº®å•è¯ + è¡Œå†…ç®­å¤´ï¼‰- å·²åœ¨ NesEditor.vue ä¸­å®ç°
- âœ… åŒºåˆ† Insert/Replace/Delete æ¨¡å¼ - INSERT/REPLACE å·²åœ¨ NesEditor.vue ä¸­æ¼”ç¤ºï¼ŒDELETE å¾…å®ç°
- âœ… å›¾æ ‡è¯­ä¹‰åŒ–ï¼ˆğŸ’¡/âš¡ï¼‰- å·²åœ¨ NesEditor.vue ä¸­å®ç°
- [ ] å›¾æ ‡è¯­ä¹‰åŒ–ï¼ˆâš ï¸ï¼‰- DELETE æ¨¡å¼å¾…å®ç°

### æ€§èƒ½éªŒæ”¶
- âœ… NES è§¦å‘é¢‘ç‡é™ä½ 50%+
- âœ… FIM å“åº”æ—¶é—´ < 1ç§’
- âœ… NES å“åº”æ—¶é—´ < 10ç§’
- âœ… æ— æ˜æ˜¾å¡é¡¿æˆ–å»¶è¿Ÿ

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- âœ… äº¤äº’æµç¨‹æ¸…æ™°ï¼ˆç”¨æˆ·çŸ¥é“ä¸‹ä¸€æ­¥åšä»€ä¹ˆï¼‰
- âœ… è§†è§‰åé¦ˆæ˜ç¡®ï¼ˆå›¾æ ‡ã€é¢œè‰²ã€ç®­å¤´ï¼‰
- âœ… é¢„è§ˆæ•ˆæœæ¸…æ™°ï¼ˆViewZone æˆ–è¡Œå†…ç®­å¤´ï¼‰
- âœ… ç¬¦åˆ GitHub Copilot çš„äº¤äº’ä¹ æƒ¯

### UI æ•ˆæœéªŒæ”¶ï¼ˆåŸºäº NesEditor.vueï¼‰
- âœ… **åœºæ™¯1**ï¼šæ•´è¡Œçº¢è‰²èƒŒæ™¯ + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆå¯¹é½ image-1.pngï¼‰
- âœ… **åœºæ™¯2**ï¼šæ•´è¡Œè“è‰²èƒŒæ™¯ + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼ˆå¯¹é½ image-3.pngï¼‰
- âœ… **åœºæ™¯3**ï¼šåªé«˜äº®å•è¯ + è¡Œå†…ç®­å¤´ + é¢„è§ˆå•è¯ï¼ˆå¯¹é½ image-2.png, image-4.pngï¼‰
- [ ] **åœºæ™¯4**ï¼šæ•´è¡Œçº¢è‰²èƒŒæ™¯ + åˆ é™¤çº¿ï¼ˆDELETE æ¨¡å¼ï¼Œå¾…å®ç°ï¼‰
- âœ… ç¼©è¿›ä¿æŒä¸€è‡´
- âœ… é¢„è§ˆè¡Œåœ¨é”™è¯¯è¡Œä¸‹æ–¹
- âœ… ç®­å¤´å’Œé¢„è§ˆå•è¯ç²¾ç¡®å¯¹é½

---

## å…­ã€é£é™©å’Œæ³¨æ„äº‹é¡¹

### é£é™© 1ï¼šViewZone å®ç°çš„æƒè¡¡
- **å½“å‰æ–¹æ¡ˆï¼š** NesEditor.vue ä½¿ç”¨ ViewZone æ˜¾ç¤ºé¢„è§ˆ
- **ä¼˜ç‚¹ï¼š** é¢„è§ˆå†…å®¹æ¸…æ™°ï¼Œä¸å¹²æ‰°åŸä»£ç ï¼Œç¼©è¿›ä¿æŒä¸€è‡´
- **ç¼ºç‚¹ï¼š** å ç”¨é¢å¤–ç©ºé—´ï¼ˆæ¯ä¸ªé¢„è§ˆå  1 è¡Œï¼‰
- **ç¼“è§£ï¼š** 
  - åœºæ™¯1/2ï¼ˆæ•´è¡Œæ›¿æ¢/æ’å…¥ï¼‰ï¼šViewZone æ˜¯æœ€ä½³æ–¹æ¡ˆ
  - åœºæ™¯3ï¼ˆå•è¯æ›¿æ¢ï¼‰ï¼šä½¿ç”¨è¡Œå†…ç®­å¤´ + ViewZone ç»„åˆï¼Œè§†è§‰æ•ˆæœå¥½

### é£é™© 2ï¼šchangeType è¯†åˆ«ä¸å‡†ç¡®
- **é£é™©ï¼š** åç«¯æ¨¡å‹å¯èƒ½æ— æ³•å‡†ç¡®è¿”å› changeType
- **ç¼“è§£ï¼š** å‰ç«¯æ·»åŠ å…œåº•é€»è¾‘ï¼Œæ ¹æ® originalLineContent åˆ¤æ–­

### é£é™© 3ï¼šç”¨æˆ·ä¹ æƒ¯æ”¹å˜
- **é£é™©ï¼š** ç”¨æˆ·å·²ç»ä¹ æƒ¯ 3 æ¬¡ Tab çš„æµç¨‹
- **ç¼“è§£ï¼š** 
  - å½“å‰å·²ç®€åŒ–ä¸º 2 æ¬¡ Tabï¼ˆè·³è½¬ + é¢„è§ˆ â†’ åº”ç”¨ï¼‰
  - æ·»åŠ é…ç½®é€‰é¡¹ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©æ—§æµç¨‹

### é£é™© 4ï¼šè¡Œå†…ç®­å¤´å¯¹é½é—®é¢˜
- **é£é™©ï¼š** åœºæ™¯3 ä¸­ç®­å¤´å’Œé¢„è§ˆå•è¯å¯èƒ½å¯¹é½ä¸å‡†ç¡®
- **ç¼“è§£ï¼š** 
  - ä½¿ç”¨ `leadingSpaces = ' '.repeat(wordStartIndex)` ç²¾ç¡®è®¡ç®—å¯¹é½ä½ç½®
  - ç§»é™¤ `margin-left`ï¼Œé¿å…åŒé‡åç§»
  - å·²åœ¨ NesEditor.vue ä¸­éªŒè¯å¯è¡Œ

---

## ä¸ƒã€æ€»ç»“

**æ ¸å¿ƒæ”¹è¿›ï¼š**
1. **å®Œå…¨åˆ†ç¦» FIM å’Œ NES è§¦å‘é€»è¾‘** - é¿å…å†²çª
2. **è°ƒæ•´ä¼˜å…ˆçº§** - FIM ä¼˜å…ˆäº NES
3. **ç®€åŒ– Tab é”®é€»è¾‘** - 3 æ¬¡æ”¹ä¸º 2 æ¬¡ï¼ˆå·²å®ç°ï¼‰
4. **å®ç°å››ç§ UI æ¨¡å¼** - å·²åœ¨ NesEditor.vue ä¸­æ¼”ç¤ºï¼š
   - åœºæ™¯1ï¼šä¸‰å…ƒè¡¨è¾¾å¼é”™è¯¯ï¼ˆæ•´è¡Œçº¢è‰² + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼‰âœ…
   - åœºæ™¯2ï¼šæ’å…¥å±æ€§ï¼ˆæ•´è¡Œè“è‰² + æ•´è¡Œç»¿è‰²é¢„è§ˆï¼‰âœ…
   - åœºæ™¯3ï¼šå•è¯/éƒ¨åˆ†æ›¿æ¢ï¼ˆåªé«˜äº®å•è¯ + è¡Œå†…ç®­å¤´ï¼‰âœ…
   - åœºæ™¯4ï¼šåˆ é™¤è¡Œï¼ˆæ•´è¡Œçº¢è‰² + åˆ é™¤çº¿ï¼‰âŒ å¾…å®ç°
5. **å®ç° Insert/Replace/Delete æ¨¡å¼** - INSERT/REPLACE å·²æ¼”ç¤ºï¼ŒDELETE å¾…å®ç°
6. **æ·»åŠ è¯­ä¹‰åŒ–å›¾æ ‡** - ğŸ’¡/âš¡ å·²å®ç°ï¼Œâš ï¸ å¾…å®ç°

**é¢„æœŸæ•ˆæœï¼š**
- è§¦å‘é¢‘ç‡é™ä½ 50%+
- ç”¨æˆ·ä½“éªŒæå‡ï¼ˆäº¤äº’æ›´æ¸…æ™°ï¼‰
- æ€§èƒ½æå‡ï¼ˆå‡å°‘æ— æ•ˆ API è°ƒç”¨ï¼‰
- å¯¹é½ GitHub Copilot çš„äº¤äº’ä¹ æƒ¯

**NesEditor.vue æ¼”ç¤ºæˆæœï¼š**
- âœ… å®Œæ•´å®ç°äº†ä¸‰ç§ UI æ¨¡å¼ï¼ˆåœºæ™¯1ã€2ã€3ï¼‰
- âŒ DELETE æ¨¡å¼ï¼ˆåœºæ™¯4ï¼‰å¾…å®ç°
- âœ… éªŒè¯äº† ViewZone æ–¹æ¡ˆçš„å¯è¡Œæ€§
- âœ… ç¡®è®¤äº†è¡Œå†…ç®­å¤´çš„å¯¹é½æ–¹æ¡ˆ
- âœ… æä¾›äº†å¯ç›´æ¥è¿ç§»åˆ° NESRenderer.ts çš„ä»£ç 

**ä¸‹ä¸€æ­¥ï¼š**
1. åœ¨ NesEditor.vue ä¸­å®ç°åœºæ™¯4ï¼ˆDELETE æ¨¡å¼ï¼‰
2. å°† NesEditor.vue çš„ UI å®ç°è¿ç§»åˆ° NESRenderer.ts
3. å®ç°è§¦å‘é€»è¾‘åˆ†ç¦»ï¼ˆEditModeDetectorï¼‰
4. è°ƒæ•´ä¼˜å…ˆçº§é…ç½®
5. ç«¯åˆ°ç«¯æµ‹è¯•
