# NES åœºæ™¯æ¢³ç†ä¸äº¤äº’è®¾è®¡

## è®¾è®¡ç›®æ ‡

- âœ… **å®Œå…¨å¯¹é½ GitHub Copilot æˆªå›¾**ï¼ˆç®­å¤´ + è“è‰²é«˜äº®ï¼‰
- âœ… **åŒ…å«æ–‡æœ¬é¢„è§ˆ**ï¼ˆè®©ç”¨æˆ·çœ‹åˆ°å…·ä½“ä¿®æ”¹å†…å®¹ï¼‰
- âœ… **æ–°å¢å’Œæ›¿æ¢éƒ½éœ€è¦é¢„è§ˆ**
- âœ… **2 æ¬¡ Tab äº¤äº’**ï¼ˆè·³è½¬ + é¢„è§ˆ â†’ åº”ç”¨ï¼‰

---

## ä¸€ã€åœºæ™¯åˆ†ç±»

æ ¹æ® `docs/refactor/target.md` æ–‡æ¡£ï¼ŒGitHub Copilot NES æ”¯æŒä»¥ä¸‹åœºæ™¯ï¼š

### 1. æ•è·å’Œä¿®æ­£é”™è¯¯ï¼ˆCatching and Correcting Mistakesï¼‰

#### 1.1 æ‹¼å†™é”™è¯¯ï¼ˆTypo Fixï¼‰
**æè¿°ï¼š** `cont x = 5` æˆ– `conts x = 5` â†’ `const x = 5`

**åœºæ™¯ç±»å‹ï¼š** âŒ **ä¸å±äº NES**
- è¿™æ˜¯å®æ—¶è¡¥å…¨ï¼ˆFIMï¼‰æˆ–æ‹¼å†™ä¿®æ­£ï¼ˆWORD_FIXï¼‰çš„èŒè´£
- åº”è¯¥ç”± `FastCompletionProvider` æˆ– `WordFixProvider` å¤„ç†
- ä¼˜å…ˆçº§æœ€é«˜ï¼ˆWORD_FIX: priority 3ï¼‰

**ä¸çº³å…¥ NES è®¾è®¡èŒƒå›´**

---

#### 1.2 é€»è¾‘é”™è¯¯ä¿®æ­£ï¼ˆLogic Fixï¼‰

##### åœºæ™¯ 1.2.1ï¼šä¸‰å…ƒè¡¨è¾¾å¼é”™è¯¯
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·ç¼–è¾‘äº†å‡½æ•°ï¼Œä½†é€»è¾‘æœ‰è¯¯
function findMax(a: number, b: number): number {
  return a > b ? b : a;  // âŒ é”™è¯¯ï¼šåº”è¯¥è¿”å› aï¼Œä½†è¿”å›äº† b
}
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®ä¿®æ”¹ç¬¬ 9 è¡Œ
return a > b ? a : b;  // âœ… ä¿®æ­£é€»è¾‘
```

**åœºæ™¯ç±»å‹ï¼š** **REPLACEï¼ˆæ›¿æ¢ï¼‰**
- æ›¿æ¢ç°æœ‰è¡Œçš„å†…å®¹
- ä¿®æ­£é€»è¾‘é”™è¯¯

**è§†è§‰è¡¨ç°ï¼š**
- ç¬¬ 9 è¡Œæ˜¾ç¤ºï¼š**ç®­å¤´ âš¡ + è“è‰²é«˜äº®**
- è·³è½¬åæ˜¾ç¤ºï¼š**ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆ`return a > b ? a : b;`ï¼‰

**äº¤äº’æµç¨‹ï¼š**
```
1. ç”¨æˆ·ç¼–è¾‘ä»£ç  â†’ NES æ£€æµ‹åˆ°é€»è¾‘é”™è¯¯
2. æ˜¾ç¤ºï¼šç®­å¤´ âš¡ + è“è‰²é«˜äº®ï¼ˆç¬¬ 9 è¡Œï¼‰
3. ç”¨æˆ·æŒ‰ Tab (ç¬¬1æ¬¡) â†’ è·³è½¬åˆ°ç¬¬ 9 è¡Œ + æ˜¾ç¤ºç°è‰²æ–‡æœ¬é¢„è§ˆ
4. ç”¨æˆ·æŒ‰ Tab (ç¬¬2æ¬¡) â†’ åº”ç”¨ä¿®æ”¹
```

---

##### åœºæ™¯ 1.2.2ï¼šé€»è¾‘è¿ç®—ç¬¦é”™è¯¯
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·ç¼–è¾‘äº†æ¡ä»¶åˆ¤æ–­ï¼Œä½†é€»è¾‘æœ‰è¯¯
function isValidStatus(value: string): boolean {
  if (value !== null || value !== undefined) {  // âŒ é”™è¯¯ï¼šåº”è¯¥ç”¨ &&
    console.log("Valid");
    return true;
  }
  return false;
}
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®ä¿®æ”¹ç¬¬ 9 è¡Œ
if (value !== null && value !== undefined) {  // âœ… ä¿®æ­£é€»è¾‘
```

**åœºæ™¯ç±»å‹ï¼š** **REPLACEï¼ˆæ›¿æ¢ï¼‰**

**è§†è§‰è¡¨ç°ï¼š**
- ç¬¬ 9 è¡Œæ˜¾ç¤ºï¼š**ç®­å¤´ âš¡ + è“è‰²é«˜äº®**
- è·³è½¬åæ˜¾ç¤ºï¼š**ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆ`if (value !== null && value !== undefined) {`ï¼‰

**äº¤äº’æµç¨‹ï¼š** åŒåœºæ™¯ 1.2.1

---

### 2. æ„å›¾å˜æ›´ï¼ˆChanging Intentï¼‰

##### åœºæ™¯ 2.1ï¼šç±»å®šä¹‰æ‰©å±•ï¼ˆæ·»åŠ å±æ€§ï¼‰
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·å°† Point æ”¹ä¸º Point3D
class Point3D {
  x: number;
  y: number;
  // å…‰æ ‡åœ¨è¿™é‡Œï¼Œç¼ºå°‘ z å±æ€§
}
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®åœ¨ç¬¬ 12 è¡Œæ’å…¥æ–°å†…å®¹
z: number;  // âœ… æ·»åŠ  z å±æ€§
```

**åœºæ™¯ç±»å‹ï¼š** **INSERTï¼ˆæ’å…¥ï¼‰**
- åœ¨ç°æœ‰å†…å®¹ä¹‹åæ’å…¥æ–°è¡Œ
- æ·»åŠ æ–°å±æ€§

**è§†è§‰è¡¨ç°ï¼š**
- ç¬¬ 12 è¡Œæ˜¾ç¤ºï¼š**ç®­å¤´ ğŸ’¡ + è“è‰²é«˜äº®**ï¼ˆæˆ–ä½¿ç”¨ç»Ÿä¸€çš„ âš¡ï¼‰
- è·³è½¬åæ˜¾ç¤ºï¼š**ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆ`  z: number;`ï¼‰

**äº¤äº’æµç¨‹ï¼š**
```
1. ç”¨æˆ·ç¼–è¾‘ç±»å Point â†’ Point3D
2. NES æ£€æµ‹åˆ°æ„å›¾å˜æ›´ï¼Œé¢„æµ‹éœ€è¦æ·»åŠ  z å±æ€§
3. æ˜¾ç¤ºï¼šç®­å¤´ ğŸ’¡ + è“è‰²é«˜äº®ï¼ˆç¬¬ 12 è¡Œï¼Œy å±æ€§ä¹‹åï¼‰
4. ç”¨æˆ·æŒ‰ Tab (ç¬¬1æ¬¡) â†’ è·³è½¬åˆ°ç¬¬ 12 è¡Œ + æ˜¾ç¤ºç°è‰²æ–‡æœ¬é¢„è§ˆ
5. ç”¨æˆ·æŒ‰ Tab (ç¬¬2æ¬¡) â†’ æ’å…¥æ–°è¡Œ
```

---

##### åœºæ™¯ 2.2ï¼šå‡½æ•°é€»è¾‘æ›´æ–°ï¼ˆä¿®æ”¹è®¡ç®—ï¼‰
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·æ¥å—äº†åœºæ™¯ 2.1 çš„å»ºè®®ï¼Œæ·»åŠ äº† z å±æ€§
class Point3D {
  x: number;
  y: number;
  z: number;  // âœ… å·²æ·»åŠ 
}

// ç°åœ¨éœ€è¦æ›´æ–° distance è®¡ç®—
function distance(p: Point3D): number {
  return Math.sqrt(p.x * p.x + p.y * p.y);  // âŒ ç¼ºå°‘ z
}
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®ä¿®æ”¹ç¬¬ 18 è¡Œ
return Math.sqrt(p.x * p.x + p.y * p.y + p.z * p.z);  // âœ… æ·»åŠ  z*z
```

**åœºæ™¯ç±»å‹ï¼š** **REPLACEï¼ˆæ›¿æ¢ï¼‰**
- æ›¿æ¢ç°æœ‰è¡Œçš„å†…å®¹
- æ›´æ–°è®¡ç®—é€»è¾‘

**è§†è§‰è¡¨ç°ï¼š**
- ç¬¬ 18 è¡Œæ˜¾ç¤ºï¼š**ç®­å¤´ âš¡ + è“è‰²é«˜äº®**
- è·³è½¬åæ˜¾ç¤ºï¼š**ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆ`return Math.sqrt(p.x * p.x + p.y * p.y + p.z * p.z);`ï¼‰

**äº¤äº’æµç¨‹ï¼š** åŒåœºæ™¯ 1.2.1

---

### 3. é‡æ„ï¼ˆRefactoringï¼‰

##### åœºæ™¯ 3.1ï¼šå˜é‡é‡å‘½å
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·é‡å‘½åå˜é‡
const userName = "Alice";  // åŸæ¥æ˜¯ name

// å…¶ä»–åœ°æ–¹è¿˜åœ¨ä½¿ç”¨æ—§åç§°
console.log("User:", name);  // âŒ åº”è¯¥æ”¹ä¸º userName
const greeting = `Hello, ${name}`;  // âŒ åº”è¯¥æ”¹ä¸º userName
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®ä¿®æ”¹ç¬¬ 15 è¡Œ
console.log("User:", userName);  // âœ… æ›´æ–°å˜é‡å

// å»ºè®®ä¿®æ”¹ç¬¬ 16 è¡Œ
const greeting = `Hello, ${userName}`;  // âœ… æ›´æ–°å˜é‡å
```

**åœºæ™¯ç±»å‹ï¼š** **REPLACEï¼ˆæ›¿æ¢ï¼‰**
- æ›¿æ¢å˜é‡å
- å¯èƒ½æœ‰å¤šä¸ªå»ºè®®ï¼ˆé˜Ÿåˆ—ï¼‰

**è§†è§‰è¡¨ç°ï¼š**
- ç¬¬ 15 è¡Œæ˜¾ç¤ºï¼š**ç®­å¤´ âš¡ + è“è‰²é«˜äº®**
- è·³è½¬åæ˜¾ç¤ºï¼š**ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆ`console.log("User:", userName);`ï¼‰

**äº¤äº’æµç¨‹ï¼š**
```
1. ç”¨æˆ·é‡å‘½åå˜é‡ name â†’ userName
2. NES æ£€æµ‹åˆ°é‡å‘½åï¼Œé¢„æµ‹éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨
3. æ˜¾ç¤ºï¼šç®­å¤´ âš¡ + è“è‰²é«˜äº®ï¼ˆç¬¬ 15 è¡Œï¼‰
4. ç”¨æˆ·æŒ‰ Tab (ç¬¬1æ¬¡) â†’ è·³è½¬åˆ°ç¬¬ 15 è¡Œ + æ˜¾ç¤ºç°è‰²æ–‡æœ¬é¢„è§ˆ
5. ç”¨æˆ·æŒ‰ Tab (ç¬¬2æ¬¡) â†’ åº”ç”¨ä¿®æ”¹
6. è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå»ºè®®ï¼ˆç¬¬ 16 è¡Œï¼‰
7. é‡å¤æ­¥éª¤ 4-5
```

---

##### åœºæ™¯ 3.2ï¼šå‘½åæ¨¡å¼æ›´æ–°
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·ä¿®æ”¹äº†å‘½åæ¨¡å¼
const user_name = "Alice";  // åŸæ¥æ˜¯ userNameï¼ˆé©¼å³°ï¼‰

// å…¶ä»–å˜é‡è¿˜åœ¨ä½¿ç”¨é©¼å³°å‘½å
const userAge = 30;  // âŒ åº”è¯¥æ”¹ä¸º user_age
const userEmail = "alice@example.com";  // âŒ åº”è¯¥æ”¹ä¸º user_email
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®ä¿®æ”¹ç¬¬ 12 è¡Œ
const user_age = 30;  // âœ… ç»Ÿä¸€å‘½åé£æ ¼

// å»ºè®®ä¿®æ”¹ç¬¬ 13 è¡Œ
const user_email = "alice@example.com";  // âœ… ç»Ÿä¸€å‘½åé£æ ¼
```

**åœºæ™¯ç±»å‹ï¼š** **REPLACEï¼ˆæ›¿æ¢ï¼‰**

**è§†è§‰è¡¨ç°ï¼š** åŒåœºæ™¯ 3.1

**äº¤äº’æµç¨‹ï¼š** åŒåœºæ™¯ 3.1

---

##### åœºæ™¯ 3.3ï¼šä»£ç é£æ ¼åŒ¹é…ï¼ˆCopy-Pasteï¼‰
**è§¦å‘æ¡ä»¶ï¼š**
```typescript
// ç”¨æˆ·ä»å…¶ä»–åœ°æ–¹å¤åˆ¶äº†ä»£ç 
function calculateTotal(items) {  // âŒ ç¼ºå°‘ç±»å‹æ³¨è§£
  return items.reduce((sum, item) => sum + item.price, 0);
}

// å½“å‰æ–‡ä»¶çš„é£æ ¼æ˜¯å¸¦ç±»å‹æ³¨è§£çš„
function calculateAverage(items: Item[]): number {
  return calculateTotal(items) / items.length;
}
```

**NES é¢„æµ‹ï¼š**
```typescript
// å»ºè®®ä¿®æ”¹ç¬¬ 8 è¡Œ
function calculateTotal(items: Item[]): number {  // âœ… æ·»åŠ ç±»å‹æ³¨è§£
```

**åœºæ™¯ç±»å‹ï¼š** **REPLACEï¼ˆæ›¿æ¢ï¼‰**

**è§†è§‰è¡¨ç°ï¼š** åŒåœºæ™¯ 1.2.1

**äº¤äº’æµç¨‹ï¼š** åŒåœºæ™¯ 1.2.1

---

## äºŒã€ç»Ÿä¸€çš„äº¤äº’è®¾è®¡

### 2.1 è§†è§‰è¡¨ç°ï¼ˆå®Œå…¨å¯¹é½æˆªå›¾ + æ–‡æœ¬é¢„è§ˆï¼‰

#### çŠ¶æ€ 1ï¼šå»ºè®®å‡ºç°ï¼ˆæœªè·³è½¬ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8  function findMax(a, b) {            â”‚
â”‚  9 âš¡ return a > b ? b : a;             â”‚  â† ç®­å¤´ + è“è‰²é«˜äº®
â”‚ 10  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è§†è§‰å…ƒç´ ï¼š**
- **ç®­å¤´å›¾æ ‡ âš¡**ï¼ˆGlyph Marginï¼‰
- **è“è‰²é«˜äº®**ï¼ˆæ•´è¡ŒèƒŒæ™¯è‰²ï¼‰
- **Hover æç¤º**ï¼ˆé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè§£é‡Šï¼‰

---

#### çŠ¶æ€ 2ï¼šè·³è½¬åï¼ˆæ˜¾ç¤ºé¢„è§ˆï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8  function findMax(a, b) {            â”‚
â”‚  9 âš¡ return a > b ? b : a;             â”‚  â† åŸä»£ç ï¼ˆä¿æŒå¯è§ï¼‰
â”‚     return a > b ? a : b;               â”‚  â† ç°è‰²æ–‡æœ¬é¢„è§ˆï¼ˆinline ghost textï¼‰
â”‚ 10  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è§†è§‰å…ƒç´ ï¼š**
- **åŸä»£ç ä¿æŒå¯è§**ï¼ˆä¸åˆ é™¤ï¼Œä¸æ·»åŠ åˆ é™¤çº¿ï¼‰
- **ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆåœ¨åŸä»£ç ä¸‹æ–¹ï¼Œä½¿ç”¨ `after` è£…é¥°å™¨ï¼‰
- **å…‰æ ‡å®šä½**ï¼ˆåœ¨åŸä»£ç è¡Œï¼‰

---

#### çŠ¶æ€ 3ï¼šåº”ç”¨å
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8  function findMax(a, b) {            â”‚
â”‚  9  return a > b ? a : b;               â”‚  â† å·²åº”ç”¨ä¿®æ”¹
â”‚ 10  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è§†è§‰å…ƒç´ ï¼š**
- æ¸…é™¤æ‰€æœ‰è£…é¥°ï¼ˆç®­å¤´ã€é«˜äº®ã€ç°è‰²æ–‡æœ¬ï¼‰
- ä»£ç å·²æ›´æ–°

---

### 2.2 INSERT æ¨¡å¼çš„ç‰¹æ®Šå¤„ç†

#### çŠ¶æ€ 1ï¼šå»ºè®®å‡ºç°ï¼ˆæœªè·³è½¬ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10  class Point3D {                     â”‚
â”‚ 11    x: number;                        â”‚
â”‚ 12 ğŸ’¡ y: number;                        â”‚  â† ç®­å¤´ + è“è‰²é«˜äº®ï¼ˆæŒ‡å‘æ’å…¥ä½ç½®ï¼‰
â”‚ 13  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜ï¼š**
- ç®­å¤´æŒ‡å‘ `y: number;` è¿™ä¸€è¡Œ
- è¡¨ç¤ºå°†åœ¨è¿™ä¸€è¡Œ**ä¹‹å**æ’å…¥æ–°å†…å®¹

---

#### çŠ¶æ€ 2ï¼šè·³è½¬åï¼ˆæ˜¾ç¤ºé¢„è§ˆï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10  class Point3D {                     â”‚
â”‚ 11    x: number;                        â”‚
â”‚ 12 ğŸ’¡ y: number;                        â”‚  â† åŸä»£ç ï¼ˆä¿æŒå¯è§ï¼‰
â”‚       z: number;                        â”‚  â† ç°è‰²æ–‡æœ¬é¢„è§ˆï¼ˆå°†æ’å…¥çš„å†…å®¹ï¼‰
â”‚ 13  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è§†è§‰å…ƒç´ ï¼š**
- **åŸä»£ç ä¿æŒå¯è§**
- **ç°è‰²æ–‡æœ¬é¢„è§ˆ**ï¼ˆåœ¨åŸä»£ç ä¸‹æ–¹ï¼Œè¡¨ç¤ºå°†æ’å…¥çš„æ–°è¡Œï¼‰

---

#### çŠ¶æ€ 3ï¼šåº”ç”¨å
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10  class Point3D {                     â”‚
â”‚ 11    x: number;                        â”‚
â”‚ 12    y: number;                        â”‚
â”‚ 13    z: number;                        â”‚  â† å·²æ’å…¥æ–°è¡Œ
â”‚ 14  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.3 Tab é”®äº¤äº’æµç¨‹ï¼ˆç»Ÿä¸€ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·ç¼–è¾‘ä»£ç                     â”‚
â”‚              â†“                          â”‚
â”‚      NES æ£€æµ‹åˆ°ç¼–è¾‘æ¨¡å¼                 â”‚
â”‚              â†“                          â”‚
â”‚      æ˜¾ç¤ºï¼šç®­å¤´ + è“è‰²é«˜äº®              â”‚
â”‚              â†“                          â”‚
â”‚   ç”¨æˆ·æŒ‰ Tab (ç¬¬1æ¬¡)                    â”‚
â”‚              â†“                          â”‚
â”‚   è·³è½¬åˆ°å»ºè®®è¡Œ + æ˜¾ç¤ºç°è‰²æ–‡æœ¬é¢„è§ˆ       â”‚
â”‚              â†“                          â”‚
â”‚   ç”¨æˆ·æŒ‰ Tab (ç¬¬2æ¬¡)                    â”‚
â”‚              â†“                          â”‚
â”‚   åº”ç”¨ä¿®æ”¹ï¼ˆREPLACE æˆ– INSERTï¼‰         â”‚
â”‚              â†“                          â”‚
â”‚   å¦‚æœæœ‰ä¸‹ä¸€ä¸ªå»ºè®®ï¼Œè‡ªåŠ¨è·³è½¬            â”‚
â”‚   å¦åˆ™ï¼Œæ¸…é™¤æ‰€æœ‰è£…é¥°                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 3.1 è£…é¥°å™¨ï¼ˆDecorationsï¼‰

#### Glyph Iconï¼ˆç®­å¤´å›¾æ ‡ï¼‰
```typescript
const glyphDecoration = {
  range: new monaco.Range(targetLine, 1, targetLine, 1),
  options: {
    glyphMarginClassName: 'nes-glyph-icon',
    glyphMarginHoverMessage: {
      value: `**${changeType}**\n\n${explanation}`
    }
  }
};
```

#### è“è‰²é«˜äº®ï¼ˆæ•´è¡ŒèƒŒæ™¯ï¼‰
```typescript
const highlightDecoration = {
  range: new monaco.Range(targetLine, 1, targetLine, maxColumn),
  options: {
    className: 'nes-line-highlight',  // è“è‰²èƒŒæ™¯
    isWholeLine: true
  }
};
```

#### ç°è‰²æ–‡æœ¬é¢„è§ˆï¼ˆInline Ghost Textï¼‰
```typescript
// REPLACE æ¨¡å¼ï¼šåœ¨åŸä»£ç ä¸‹æ–¹æ˜¾ç¤ºé¢„è§ˆ
const ghostTextDecoration = {
  range: new monaco.Range(targetLine, maxColumn, targetLine, maxColumn),
  options: {
    after: {
      content: `\n${suggestionText}`,  // æ¢è¡Œ + å»ºè®®æ–‡æœ¬
      inlineClassName: 'nes-ghost-text'  // ç°è‰²æ ·å¼
    }
  }
};

// INSERT æ¨¡å¼ï¼šåœ¨åŸä»£ç ä¸‹æ–¹æ˜¾ç¤ºé¢„è§ˆ
const ghostTextDecoration = {
  range: new monaco.Range(targetLine, maxColumn, targetLine, maxColumn),
  options: {
    after: {
      content: `\n${suggestionText}`,  // æ¢è¡Œ + å»ºè®®æ–‡æœ¬
      inlineClassName: 'nes-ghost-text-insert'  // ç°è‰²æ ·å¼ï¼ˆå¯èƒ½éœ€è¦ç¼©è¿›ï¼‰
    }
  }
};
```

---

### 3.2 CSS æ ·å¼

```css
/* ç®­å¤´å›¾æ ‡ */
.nes-glyph-icon::before {
  content: 'âš¡';
  font-size: 16px;
  color: #007acc;
}

/* è“è‰²é«˜äº® */
.nes-line-highlight {
  background-color: rgba(0, 122, 204, 0.1);  /* æµ…è“è‰²èƒŒæ™¯ */
  border-left: 3px solid #007acc;  /* å·¦ä¾§è“è‰²è¾¹æ¡† */
}

/* ç°è‰²æ–‡æœ¬é¢„è§ˆ */
.nes-ghost-text {
  color: #6c757d;
  opacity: 0.6;
  font-style: italic;
}

.nes-ghost-text-insert {
  color: #6c757d;
  opacity: 0.6;
  font-style: italic;
  /* å¯èƒ½éœ€è¦æ·»åŠ ç¼©è¿› */
}
```

---

### 3.3 NESRenderer å®ç°

```typescript
// NESRenderer.ts
export class NESRenderer {
  /**
   * æ˜¾ç¤ºå»ºè®®ï¼ˆç®­å¤´ + è“è‰²é«˜äº®ï¼‰
   */
  public showSuggestion(prediction: Prediction): void {
    const { targetLine, changeType, explanation } = prediction;
    
    // 1. æ˜¾ç¤º Glyph Icon
    this.decorationManager.renderGlyphIcon(targetLine, changeType, explanation);
    
    // 2. æ˜¾ç¤ºè“è‰²é«˜äº®
    this.decorationManager.highlightLine(targetLine);
  }
  
  /**
   * æ˜¾ç¤ºé¢„è§ˆï¼ˆç°è‰²æ–‡æœ¬ï¼‰
   */
  public showPreview(prediction: Prediction): void {
    const { targetLine, suggestionText, changeType } = prediction;
    
    if (changeType === 'REPLACE') {
      // æ›¿æ¢æ¨¡å¼ï¼šåœ¨åŸä»£ç ä¸‹æ–¹æ˜¾ç¤ºé¢„è§ˆ
      this.decorationManager.showGhostText(targetLine, suggestionText);
    } else if (changeType === 'INSERT') {
      // æ’å…¥æ¨¡å¼ï¼šåœ¨åŸä»£ç ä¸‹æ–¹æ˜¾ç¤ºé¢„è§ˆï¼ˆå¯èƒ½éœ€è¦ç¼©è¿›ï¼‰
      this.decorationManager.showGhostTextInsert(targetLine, suggestionText);
    }
  }
  
  /**
   * åº”ç”¨å»ºè®®
   */
  public applySuggestion(prediction: Prediction): void {
    const { targetLine, suggestionText, changeType } = prediction;
    const model = this.editor.getModel();
    if (!model) return;
    
    if (changeType === 'REPLACE') {
      // æ›¿æ¢æ•´è¡Œ
      const edit = {
        range: new monaco.Range(targetLine, 1, targetLine, model.getLineMaxColumn(targetLine)),
        text: suggestionText,
        forceMoveMarkers: true
      };
      this.editor.executeEdits('nes-replace', [edit]);
    } else if (changeType === 'INSERT') {
      // åœ¨å½“å‰è¡Œä¹‹åæ’å…¥æ–°è¡Œ
      const edit = {
        range: new monaco.Range(targetLine, model.getLineMaxColumn(targetLine), targetLine, model.getLineMaxColumn(targetLine)),
        text: `\n${suggestionText}`,
        forceMoveMarkers: true
      };
      this.editor.executeEdits('nes-insert', [edit]);
    }
    
    // æ¸…é™¤è£…é¥°
    this.clear();
  }
}
```

---

### 3.4 NESController å®ç°

```typescript
// NESController.ts
public applySuggestion(): void {
  if (!this.hasActiveSuggestion()) {
    return;
  }

  const prediction = this.suggestionQueue.current();
  if (!prediction) return;

  // åœºæ™¯ 1ï¼šç”¨æˆ·ä¸åœ¨å»ºè®®è¡Œ â†’ è·³è½¬ + æ˜¾ç¤ºé¢„è§ˆ
  if (!this.isUserOnSuggestionLine) {
    console.log('[NESController] ğŸ§­ Navigating to suggestion line');
    
    // è·³è½¬åˆ°å»ºè®®è¡Œ
    this.jumpToSuggestionWithSmartCursor(prediction);
    this.isUserOnSuggestionLine = true;
    
    // æ˜¾ç¤ºç°è‰²æ–‡æœ¬é¢„è§ˆ
    this.renderer.showPreview(prediction);
    
    // æ›´æ–° HintBar
    this.updateHintBar(prediction);
    return;
  }

  // åœºæ™¯ 2ï¼šç”¨æˆ·åœ¨å»ºè®®è¡Œ â†’ åº”ç”¨å»ºè®®
  console.log('[NESController] âœ… Accepting suggestion (applying code)');
  this.acceptSuggestion();
}
```

---

## å››ã€åœºæ™¯æ€»ç»“è¡¨

| åœºæ™¯ | ç±»å‹ | è§¦å‘æ¡ä»¶ | è§†è§‰è¡¨ç° | äº¤äº’æµç¨‹ |
|------|------|----------|----------|----------|
| é€»è¾‘é”™è¯¯ä¿®æ­£ | REPLACE | æ£€æµ‹åˆ°é€»è¾‘é”™è¯¯ | ç®­å¤´ âš¡ + è“è‰²é«˜äº® | Tab è·³è½¬ + é¢„è§ˆ â†’ Tab åº”ç”¨ |
| ç±»å®šä¹‰æ‰©å±• | INSERT | ç±»åå˜æ›´ï¼ˆPoint â†’ Point3Dï¼‰ | ç®­å¤´ ğŸ’¡ + è“è‰²é«˜äº® | Tab è·³è½¬ + é¢„è§ˆ â†’ Tab åº”ç”¨ |
| å‡½æ•°é€»è¾‘æ›´æ–° | REPLACE | ç±»å±æ€§å˜æ›´å | ç®­å¤´ âš¡ + è“è‰²é«˜äº® | Tab è·³è½¬ + é¢„è§ˆ â†’ Tab åº”ç”¨ |
| å˜é‡é‡å‘½å | REPLACE | æ£€æµ‹åˆ°å˜é‡é‡å‘½å | ç®­å¤´ âš¡ + è“è‰²é«˜äº® | Tab è·³è½¬ + é¢„è§ˆ â†’ Tab åº”ç”¨ï¼ˆå¤šæ¬¡ï¼‰ |
| å‘½åæ¨¡å¼æ›´æ–° | REPLACE | æ£€æµ‹åˆ°å‘½åé£æ ¼å˜æ›´ | ç®­å¤´ âš¡ + è“è‰²é«˜äº® | Tab è·³è½¬ + é¢„è§ˆ â†’ Tab åº”ç”¨ï¼ˆå¤šæ¬¡ï¼‰ |
| ä»£ç é£æ ¼åŒ¹é… | REPLACE | æ£€æµ‹åˆ°ç²˜è´´ä»£ç  | ç®­å¤´ âš¡ + è“è‰²é«˜äº® | Tab è·³è½¬ + é¢„è§ˆ â†’ Tab åº”ç”¨ |

---

## äº”ã€ä¸å½“å‰å®ç°çš„å·®å¼‚

### å½“å‰å®ç°ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
- âŒ ä½¿ç”¨ ViewZoneï¼ˆDiff é¢æ¿ï¼‰æ˜¾ç¤ºé¢„è§ˆ
- âŒ éœ€è¦ 3 æ¬¡ Tabï¼ˆè·³è½¬ â†’ é¢„è§ˆ â†’ åº”ç”¨ï¼‰
- âŒ é¢„è§ˆå ç”¨é¢å¤–ç©ºé—´

### ç›®æ ‡å®ç°ï¼ˆå¯¹é½æˆªå›¾ + æ–‡æœ¬é¢„è§ˆï¼‰
- âœ… ä½¿ç”¨ç°è‰²æ–‡æœ¬ï¼ˆinline ghost textï¼‰æ˜¾ç¤ºé¢„è§ˆ
- âœ… åªéœ€ 2 æ¬¡ Tabï¼ˆè·³è½¬ + é¢„è§ˆ â†’ åº”ç”¨ï¼‰
- âœ… é¢„è§ˆä¸å ç”¨é¢å¤–ç©ºé—´ï¼ˆåœ¨åŸä»£ç ä¸‹æ–¹ï¼‰
- âœ… ç®­å¤´ + è“è‰²é«˜äº®ï¼ˆå®Œå…¨å¯¹é½æˆªå›¾ï¼‰

---

## å…­ã€å®æ–½ä¼˜å…ˆçº§

### Phase 1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»ï¼‰
- [ ] å®ç°ç°è‰²æ–‡æœ¬é¢„è§ˆï¼ˆæ›¿æ¢ ViewZoneï¼‰
- [ ] ç®€åŒ– Tab é”®é€»è¾‘ï¼ˆ3æ¬¡ â†’ 2æ¬¡ï¼‰
- [ ] å®ç° REPLACE å’Œ INSERT ä¸¤ç§æ¨¡å¼
- [ ] æµ‹è¯•åŸºæœ¬äº¤äº’æµç¨‹

### Phase 2ï¼šè§†è§‰ä¼˜åŒ–ï¼ˆé‡è¦ï¼‰
- [ ] ä¼˜åŒ–è“è‰²é«˜äº®æ ·å¼ï¼ˆå¯¹é½æˆªå›¾ï¼‰
- [ ] ä¼˜åŒ–ç®­å¤´å›¾æ ‡æ ·å¼
- [ ] ä¼˜åŒ–ç°è‰²æ–‡æœ¬æ ·å¼ï¼ˆé¢œè‰²ã€é€æ˜åº¦ã€æ–œä½“ï¼‰
- [ ] æµ‹è¯•è§†è§‰æ•ˆæœ

### Phase 3ï¼šåœºæ™¯æ”¯æŒï¼ˆé‡è¦ï¼‰
- [ ] å®ç°é€»è¾‘é”™è¯¯æ£€æµ‹
- [ ] å®ç°æ„å›¾å˜æ›´æ£€æµ‹
- [ ] å®ç°å˜é‡é‡å‘½åæ£€æµ‹
- [ ] æµ‹è¯•æ‰€æœ‰åœºæ™¯

### Phase 4ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
- [ ] ä¼˜åŒ–è§¦å‘é¢‘ç‡ï¼ˆå‡å°‘æ— æ•ˆé¢„æµ‹ï¼‰
- [ ] æ·»åŠ ç¼“å­˜æœºåˆ¶
- [ ] ä¼˜åŒ–å“åº”æ—¶é—´

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- âœ… æ”¯æŒ REPLACE å’Œ INSERT ä¸¤ç§æ¨¡å¼
- âœ… Tab é”®åªéœ€ 2 æ¬¡ï¼ˆè·³è½¬ + é¢„è§ˆ â†’ åº”ç”¨ï¼‰
- âœ… æ˜¾ç¤ºç°è‰²æ–‡æœ¬é¢„è§ˆï¼ˆä¸ä½¿ç”¨ ViewZoneï¼‰
- âœ… ç®­å¤´ + è“è‰²é«˜äº®ï¼ˆå¯¹é½æˆªå›¾ï¼‰

### è§†è§‰éªŒæ”¶
- âœ… è“è‰²é«˜äº®æ ·å¼ä¸æˆªå›¾ä¸€è‡´
- âœ… ç°è‰²æ–‡æœ¬æ¸…æ™°å¯è§ä½†ä¸å¹²æ‰°é˜…è¯»
- âœ… ç®­å¤´å›¾æ ‡ä½ç½®æ­£ç¡®

### äº¤äº’éªŒæ”¶
- âœ… ç”¨æˆ·æ¸…æ¥šçŸ¥é“ä¸‹ä¸€æ­¥æ“ä½œï¼ˆHintBar æç¤ºï¼‰
- âœ… é¢„è§ˆå†…å®¹å‡†ç¡®ï¼ˆä¸æœ€ç»ˆåº”ç”¨çš„å†…å®¹ä¸€è‡´ï¼‰
- âœ… å¤šä¸ªå»ºè®®æ—¶è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€ä¸ª

### åœºæ™¯éªŒæ”¶
- âœ… é€»è¾‘é”™è¯¯ä¿®æ­£åœºæ™¯æ­£å¸¸å·¥ä½œ
- âœ… æ„å›¾å˜æ›´åœºæ™¯æ­£å¸¸å·¥ä½œ
- âœ… å˜é‡é‡å‘½ååœºæ™¯æ­£å¸¸å·¥ä½œ
- âœ… ä»£ç é£æ ¼åŒ¹é…åœºæ™¯æ­£å¸¸å·¥ä½œ
